---
title: "Probability"
output:
  html_document: 
    toc: yes
    toc_depth: 2
    toc_float: yes
    highlight: zenburn
    code_download: true
    includes:
      in_header: header.html
---


# Discrete Probability

```{r}
beads <- rep( c('red', 'blue'), times = c(2,3))
beads
```
Produces a random outcome
```{r}
sample( beads,1)
```

Goal is to repeat the experiment a large number of times to give an accurate probability if the experiment was repeated infinity. 

We can use a Monte Carlo simulation. To do this, we can use the `replicate()` function to repeat the same task any number of times we want.

```{r}
B <- 10000
events <- replicate(B, sample(beads,1))
```

We can create a table of our outcomes using the `table()` function as well as see the proportion by using `prop.table()`.
```{r}
tab <- table(events)
tab
prop.table(tab)
```

We actually don't have to use the `replicate()` function for this example because the `sample()` function actually has an argument that permits us to pick more than one element form the urn **with replacement**. 

```{r}
events <- sample(beads, B, replace=TRUE)
prop.table(table(events))
```

In R, applying the `mean()` function to a logical vector returns the proportion of elements that are *TRUE*. It is very common to use the `mean()` function in this way to calculate probabilities and we will do so throughout the course.

Suppose you have the vector beads from a previous video:

```{r}
beads <- rep(c("red", "blue"), times = c(2,3))
beads
```

To find the probability of drawing a blue bead at random, you can run:

```{r}
mean(beads == "blue")
```

This code is broken down into steps inside R. First, R evaluates the logical statement `beads == "blue"`, which generates the vector:

`FALSE FALSE TRUE TRUE TRUE`

When the mean function is applied, R coerces the logical values to numeric values, changing TRUE to 1 and FALSE to 0:

`0 0 1 1 1`

The mean of the zeros and ones thus gives the proportion of TRUE values. As we have learned and will continue to see, probabilities are directly related to the proportion of events that satisfy a requirement.

# Probability distributions

Defining a distribution for categorical outcomes is straight forward. We assign a probability to each category.

Two events are independent if the outcome of one does not affect the outcome of the other e.g. coin toss or picking beads with replacement.

When events are not independent, conditional probabilities are useful and necessary to make correct calculations

To calculate the probability that the second card dealt from a deck of cards is a king, given that the first card dealt was a king. The `|` pipe means `given that or conditional on`

` Pr(Card 2 is a king) | Card 1 is a king) = 3/51`    

If the probability of A and B are independent, you can express the probability of A like this:

`Pr(A|B)=Pr(A)`

It doesn't matter what the probability of B is in this example because the probabilities are independent. 

If we want to know the probability of A and B occurring, we can use the **multiplication rule**. The probability of A and and B is equal to the probability of A multiplied by the probability of B given that A already happened.

`Pr(A and B) = Pr(A)*Pr(B|A)`

In blackjack, you can calculate the probability of you first getting an *Ace* then having the next card be a *face* card or a *10* using the following:

`Pr(Ace and face) = Pr(Ace)*Pr(Face|Ace)`

```{r}
1/13 * 16/51
```

So, the probability of A and B and C is equal to the probability of A times the probability of B given that A happened times the probability of C given that A and B happened

`Pr(A and B and C) = Pr(A)*Pr(B|A)*Pr(C|A and B)`

One ball will be drawn at random from a box containing: 3 cyan balls, 5 magenta balls, and 7 yellow balls.

```{r}
box <- rep( c('cyan', 'magenta', 'yellow'), times = c(3,5,7))
box
```

Instead of taking just one draw, consider taking two draws. You take the second draw without returning the first draw to the box. We call this sampling without replacement.

```{r}
3/15 * 12/14
```
Now repeat the experiment, but this time, after taking the first draw and recording the color, return it back to the box and shake the box. We call this sampling with replacement.

What is the probability that the first draw is cyan and that the second draw is not cyan?

```{r}
3/15 * 12/15
```

# Combinations and Permutations

```{r}
# joining strings with paste
number <- "Three"
suit <- "Hearts"
paste(number, suit)

# joining vectors element-wise with paste
paste(letters[1:5], as.character(1:5))
```

The function `expland.grid()` gives us all combinations of 2 lists.

```{r}
expand.grid(pants = c("blue", "black"), shirt = c("white", "grey", "plaid"))
```

To generate a deck of cards:

```{r}
suits <- c("Diamonds", "Clubs", "Hearts", "Spades")
numbers <- c("Ace", "Deuce", "Three", "Four", "Five", "Six", "Seven", "Eight", "Nine", "Ten", "Jack", "Queen", "King")
deck <- expand.grid(number = numbers, suit = suits)
deck <- paste(deck$number, deck$suit)
```

To find the probability of drawing a king:

```{r}
kings <- paste("King", suits)
mean(deck %in% kings)
```
What is the conditional probability of the second card is a king?

The `permutations()` function computes, for any list of size 'n' all the different ways we can select 'r' items.
```{r}
library(gtools)
# This will calculate all the ways you can choose 2 numbers from a list of 1-5.
permutations(5,2)
```

To compute all the possible ways that you can choose 2 cards *when the order matters* we can type:

```{r}
# We have 52 cards, we will choose 2, and we will select them from the vector of our card names
hands <- permutations(52,2, v = deck)

first_card <- hands[,1]

second_card <- hands[,2]
# How many cases is the first card a king?
sum(first_card %in% kings)
# We ask how what fraction of these 204 also have a king in the second card?
sum(first_card %in% kings & second_card %in% kings) / sum(first_card %in% kings)
```

What if the **order does not matter**? Use the `combinations()` function since the order doesn't matter.

Compare the two functions

```{r}
permutations(3,2)
combinations(3,2)
```
Define a vector that includes all the aces, avector that includes all the face cards and 10's, then generate all the combinations of picking 2 cards out of 52.

```{r}
aces <- paste("Ace", suits)
facecard <- c("King", "Queen", "Jack", "Ten")
facecard <- expand.grid(number = facecard, suit = suits)
facecard <- paste(facecard$number, facecard$suit)

hands <- combinations(52, 2, v=deck) # all possible hands
# probability of a natural 21 given that the ace is listed first in `combinations`
mean(hands[,1] %in% aces & hands[,2] %in% facecard)
```

You can also use a Monte Carlo simulation to calculate the probability of getting blackjack on the first 2 cards.

Use the `sample()` function to draw cards without replacement
```{r}
hand <- sample(deck, 2)
hand
```
```{r}
# code for B=10,000 hands of blackjack
B <- 10000
results <- replicate(B, {
    hand <- sample(deck, 2)
    (hand[1] %in% aces & hand[2] %in% facecard) | (hand[2] %in% aces & hand[1] %in% facecard)
})
mean(results)
```

## The birthday problem

If you are in a classroom with 50 people, assuming it is a randomly selected group, what is the chance that at least 2 people have the same birthday?

We will calculate this later, but first we can use the Monte Carlo simulation.

```{r}
n <- 50
calendar <- 1:365
bdays <- sample(calendar, n, replace=TRUE)
```

To check to see if two people have the same birthday, use the function `duplicated()` which returns *TRUE* if any element of a vector has already appeared in that vector.

```{r}
any(duplicated(bdays))
```

```{r}
b <- 10000
results <- replicate(B,{
  bdays <- sample(calendar, n, replace=TRUE)
  any(duplicated(bdays))
})
```

Take the mean to determine how likely it is for two people to have the same birthday
```{r}
mean(results)
```

# sapply

`sapply()` allows us to perform element-wise operations on any function. 

This will apply square root to each element of x. You actually don't need to do this because `sqrt()` already operates on a vector element by element, but some functions do not.

```{r}
x <- 1:10
sapply(x, sqrt)
```

If you wanted to bet on the chances that 2 people have the same birthday in a group of people, you can use a Monte Carlo simulation. We will define a function to cacluate the probability of shared bdays across n people.

```{r cache=TRUE}
compute_prob <- function(n, B = 10000) {
	same_day <- replicate(B, {
    	bdays <- sample(1:365, n, replace = TRUE)
        any(duplicated(bdays))
    })
    mean(same_day)
}

n <- seq(1, 60)
prob <- sapply(n, compute_prob)
```


```{r}
plot(n, prob)
```

If we wanted to compute the exact value instead of using a Monte Carlo Simulation we can calculate the exact value. Instead of calculating the probability of it happening, it is faster to calculate the probability of it not happening then use the multiplication rule.

Starting with person 1, the probability that they have a unique birthday is 1.

We can compute the probability of shared birthdays mathematically:

<math xmlns="http://www.w3.org/1998/Math/MathML">
  <maction id="MJX-Collapse-9" actiontype="toggle" selection="2" data-semantic-complexity="3">
    <mtext data-semantic-complexity="3">&#x25C2;...&#x25B8;</mtext>
    <mrow data-semantic-complexity="20" data-semantic-collapsed="(47 (c 44 45 46) 0 40 4 43)" data-semantic-children="0,40,4,43" data-semantic-id="47" data-semantic-role="text" data-semantic-type="punctuated">
      <mrow>
        <mstyle displaystyle="false" scriptlevel="0" data-semantic-complexity="3">
          <maction id="MJX-Collapse-2" actiontype="toggle" selection="2" data-semantic-complexity="3">
            <mtext data-semantic-complexity="3">&#x25C2;...&#x25B8;</mtext>
            <mtext data-semantic-type="text" data-semantic-role="unknown" data-semantic-font="normal" data-semantic-id="0" data-semantic-parent="47" data-semantic-complexity="10.5">Pr(shared birthdays)</mtext>
          </maction>
        </mstyle>
        <mrow data-semantic-type="relseq" data-semantic-role="equality" data-semantic-id="40" data-semantic-children="38,39" data-semantic-content="1" data-semantic-parent="47" data-semantic-complexity="8">
          <mrow data-semantic-type="empty" data-semantic-role="unknown" data-semantic-id="38" data-semantic-parent="40" data-semantic-complexity="0" />
          <mo data-semantic-type="relation" data-semantic-role="equality" data-semantic-id="1" data-semantic-parent="40" data-semantic-operator="relseq,=" data-semantic-complexity="1">=</mo>
          <mrow data-semantic-type="postfixop" data-semantic-role="subtraction" data-semantic-id="39" data-semantic-children="2" data-semantic-content="3" data-semantic-parent="40" data-semantic-complexity="4">
            <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="2" data-semantic-parent="39" data-semantic-complexity="1">1</mn>
            <mo data-semantic-type="operator" data-semantic-role="subtraction" data-semantic-id="3" data-semantic-parent="39" data-semantic-operator="postfixop,&#x2212;" data-semantic-complexity="1">&#x2212;</mo>
          </mrow>
        </mrow>
        <mstyle displaystyle="false" scriptlevel="0" data-semantic-complexity="3">
          <maction id="MJX-Collapse-3" actiontype="toggle" selection="2" data-semantic-complexity="3">
            <mtext data-semantic-complexity="3">&#x25C2;...&#x25B8;</mtext>
            <mtext data-semantic-type="text" data-semantic-role="unknown" data-semantic-font="normal" data-semantic-id="4" data-semantic-parent="47" data-semantic-complexity="12">Pr(no shared birthdays)</mtext>
          </maction>
        </mstyle>
        <maction id="MJX-Collapse-8" actiontype="toggle" selection="2" data-semantic-complexity="2">
          <mtext data-semantic-complexity="2">&#x25C2;=&#x25B8;</mtext>
          <mrow data-semantic-type="relseq" data-semantic-role="equality" data-semantic-id="43" data-semantic-children="41,42" data-semantic-content="5" data-semantic-parent="47" data-semantic-complexity="16">
            <mrow data-semantic-type="empty" data-semantic-role="unknown" data-semantic-id="41" data-semantic-parent="43" data-semantic-complexity="0" />
            <mo data-semantic-type="relation" data-semantic-role="equality" data-semantic-id="5" data-semantic-parent="43" data-semantic-operator="relseq,=" data-semantic-complexity="1">=</mo>
            <mrow data-semantic-type="infixop" data-semantic-role="subtraction" data-semantic-id="42" data-semantic-children="6,37" data-semantic-content="7" data-semantic-parent="43" data-semantic-complexity="12">
              <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="6" data-semantic-parent="42" data-semantic-complexity="1">1</mn>
              <mo data-semantic-type="operator" data-semantic-role="subtraction" data-semantic-id="7" data-semantic-parent="42" data-semantic-operator="infixop,&#x2212;" data-semantic-complexity="1">&#x2212;</mo>
              <mrow data-semantic-type="fenced" data-semantic-role="leftright" data-semantic-id="37" data-semantic-children="36" data-semantic-content="8,32" data-semantic-parent="42" data-semantic-complexity="7">
                <mo stretchy="false" data-semantic-type="fence" data-semantic-role="open" data-semantic-id="8" data-semantic-parent="37" data-semantic-operator="fenced" data-semantic-complexity="1">(</mo>
                <maction id="MJX-Collapse-7" actiontype="toggle" selection="2" data-semantic-complexity="2">
                  <mtext data-semantic-complexity="2">&#x25C2;,&#x25B8;</mtext>
                  <mrow data-semantic-type="punctuated" data-semantic-role="sequence" data-semantic-id="36" data-semantic-children="33,19,20,21,35" data-semantic-content="19,20,21" data-semantic-parent="37" data-semantic-complexity="15">
                    <maction id="MJX-Collapse-4" actiontype="toggle" selection="2" data-semantic-complexity="2">
                      <mtext data-semantic-complexity="2">&#x25C2;+&#x25B8;</mtext>
                      <mrow data-semantic-type="infixop" data-semantic-role="unknown" data-semantic-id="33" data-semantic-children="9,13,34" data-semantic-content="10,14" data-semantic-parent="36" data-semantic-complexity="24.6">
                        <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="9" data-semantic-parent="33" data-semantic-complexity="1">1</mn>
                        <mo data-semantic-type="operator" data-semantic-role="unknown" data-semantic-id="10" data-semantic-parent="33" data-semantic-operator="infixop,&#xD7;" data-semantic-complexity="1">&#xD7;</mo>
                        <mfrac data-semantic-type="fraction" data-semantic-role="vulgar" data-semantic-id="13" data-semantic-children="11,12" data-semantic-parent="33" data-semantic-complexity="6.800000000000001">
                          <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="11" data-semantic-parent="13" data-semantic-complexity="2">364</mn>
                          <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="12" data-semantic-parent="13" data-semantic-complexity="2">365</mn>
                        </mfrac>
                        <mo data-semantic-type="operator" data-semantic-role="unknown" data-semantic-id="14" data-semantic-parent="33" data-semantic-operator="infixop,&#xD7;" data-semantic-complexity="1">&#xD7;</mo>
                        <mrow data-semantic-type="postfixop" data-semantic-role="unknown" data-semantic-id="34" data-semantic-children="17" data-semantic-content="18" data-semantic-parent="33" data-semantic-complexity="9.8">
                          <mfrac data-semantic-type="fraction" data-semantic-role="vulgar" data-semantic-id="17" data-semantic-children="15,16" data-semantic-parent="34" data-semantic-complexity="6.800000000000001">
                            <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="15" data-semantic-parent="17" data-semantic-complexity="2">363</mn>
                            <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="16" data-semantic-parent="17" data-semantic-complexity="2">365</mn>
                          </mfrac>
                          <mo data-semantic-type="operator" data-semantic-role="unknown" data-semantic-id="18" data-semantic-parent="34" data-semantic-operator="postfixop,&#xD7;" data-semantic-complexity="1">&#xD7;</mo>
                        </mrow>
                      </mrow>
                    </maction>
                    <mo data-semantic-type="punctuation" data-semantic-role="fullstop" data-semantic-id="19" data-semantic-parent="36" data-semantic-operator="punctuated" data-semantic-complexity="1">.</mo>
                    <mo data-semantic-type="punctuation" data-semantic-role="fullstop" data-semantic-id="20" data-semantic-parent="36" data-semantic-operator="punctuated" data-semantic-complexity="1">.</mo>
                    <mo data-semantic-type="punctuation" data-semantic-role="fullstop" data-semantic-id="21" data-semantic-parent="36" data-semantic-operator="punctuated" data-semantic-complexity="1">.</mo>
                    <mrow data-semantic-type="prefixop" data-semantic-role="unknown" data-semantic-id="35" data-semantic-children="31" data-semantic-content="22" data-semantic-parent="36" data-semantic-complexity="5">
                      <mo data-semantic-type="operator" data-semantic-role="unknown" data-semantic-id="22" data-semantic-parent="35" data-semantic-operator="prefixop,&#xD7;" data-semantic-complexity="1">&#xD7;</mo>
                      <maction id="MJX-Collapse-5" actiontype="toggle" selection="2" data-semantic-complexity="2">
                        <mtext data-semantic-complexity="2">&#x25C2;/&#x25B8;</mtext>
                        <mfrac data-semantic-type="fraction" data-semantic-role="division" data-semantic-id="31" data-semantic-children="29,30" data-semantic-parent="35" data-semantic-complexity="14.8">
                          <mrow data-semantic-type="infixop" data-semantic-role="addition" data-semantic-id="29" data-semantic-children="28,27" data-semantic-content="26" data-semantic-parent="31" data-semantic-complexity="12">
                            <mrow data-semantic-type="infixop" data-semantic-role="subtraction" data-semantic-id="28" data-semantic-children="23,25" data-semantic-content="24" data-semantic-parent="29" data-semantic-complexity="7">
                              <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="23" data-semantic-parent="28" data-semantic-complexity="2">365</mn>
                              <mo data-semantic-type="operator" data-semantic-role="subtraction" data-semantic-id="24" data-semantic-parent="28" data-semantic-operator="infixop,&#x2212;" data-semantic-complexity="1">&#x2212;</mo>
                              <mi data-semantic-type="identifier" data-semantic-role="latinletter" data-semantic-font="italic" data-semantic-id="25" data-semantic-parent="28" data-semantic-complexity="1">n</mi>
                            </mrow>
                            <mo data-semantic-type="operator" data-semantic-role="addition" data-semantic-id="26" data-semantic-parent="29" data-semantic-operator="infixop,+" data-semantic-complexity="1">+</mo>
                            <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="27" data-semantic-parent="29" data-semantic-complexity="1">1</mn>
                          </mrow>
                          <mn data-semantic-type="number" data-semantic-role="integer" data-semantic-font="normal" data-semantic-id="30" data-semantic-parent="31" data-semantic-complexity="2">365</mn>
                        </mfrac>
                      </maction>
                    </mrow>
                  </mrow>
                </maction>
                <mo stretchy="false" data-semantic-type="fence" data-semantic-role="close" data-semantic-id="32" data-semantic-parent="37" data-semantic-operator="fenced" data-semantic-complexity="1">)</mo>
              </mrow>
            </mrow>
          </mrow>
        </maction>
      </mrow>
    </mrow>
  </maction>
</math>


```{r}
exact_prob <- function(n){
  prob_unique <- seq(365, 365-n+1)/365
  # the probabilty of an event happening is 1 minus the probability of the event not happening
  1 - prod( prob_unique)
}
eprob <- sapply(n, exact_prob)
# Compare monte carlo plot to exact probabilty plot
plot(n, prob)
lines(n, eprob, col = 'red')
```

