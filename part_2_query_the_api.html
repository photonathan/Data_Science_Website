<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Visualizing Arlington Bikometers</title>

<script src="site_libs/header-attrs-2.7/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<link rel="apple-touch-icon" sizes="180x180" href="~/assets/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/favicon/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/favicon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-sm-12 col-md-4 col-lg-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-sm-12 col-md-8 col-lg-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Nathan's Projects</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Visualizing Arlington Bikeometers
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="part_1_the_plan.html">Part 1: The Plan</a>
    </li>
    <li>
      <a href="part_2_query_the_api.html">Part 2: Query the API</a>
    </li>
    <li>
      <a href="part_3_setup_your_database.html">Part 3: Setup and Connect Your Database</a>
    </li>
    <li>
      <a href="part_4_save_the_data_in_a_mysql_database.html">Part 4: Save the Data in Your Local MySQL Database</a>
    </li>
    <li>
      <a href="part_5_picking_bikeometers_to_graph.html">Part 5: Picking Which Bikeometers to Graph</a>
    </li>
    <li>
      <a href="part_6_creating_initial_visualizations.html">Part 6: Creating the Initial Visualizations</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Notes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="note_fixing_rpytools_error.html">Fixing rpytools error</a>
    </li>
  </ul>
</li>
<li>
  <a href="photography.html">Photography</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/photonathan">Github</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Visualizing Arlington Bikometers</h1>
<h3 class="subtitle">Part 2: Query the Bike Arlington API</h3>

</div>


<p> <br />
 </p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The Official <a href="http://counters.bikearlington.com/data-for-developers/">Bike Arlington</a> API is accessed through <a href="http://webservices.commuterpage.com/counters.cfc?wsdl">this URL</a> with multiple endpoints/methods to get everything from the number of bikers or pedestrians passing a Bikeometer that day, longitude/latitude of each Bikeometer, to the weather that day.</p>
<div id="goal" class="section level2">
<h2>Goal</h2>
<ol style="list-style-type: decimal">
<li>Using Python, query the Bike Arlington API for the physical details of each Bikeometer and the counts of number of bikers in a date range.</li>
<li>Isolate the required data.</li>
<li>Move the data into a pandas data frame.</li>
<li>Create a Python function that automates the above goals.</li>
</ol>
</div>
</div>
<div id="requesting-bikeometer-details" class="section level1">
<h1>Requesting Bikeometer Details</h1>
<div id="step-1-make-a-request" class="section level2">
<h2>Step 1: Make a request</h2>
<p>We can read <a href="http://counters.bikearlington.com/bike/assets/File/Regional_bikearlington_webservices.pdf">here</a> about the different methods available when making requests to the Bike Arlington API.</p>
<p>First, let’s get some details on the Bikeometers in the database. There is a method listed ‘GetAllCounters’ that will return the details of the bikeometers in the database. I’ll use the ‘requests’ library to make a ‘GET’ request to the base Bike Arlington URL and pass in the ‘GetAllCounters’ method as a parameter.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the url of the </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&#39;http://webservices.commuterpage.com/counters.cfc?wsdl&#39;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Defines the method in a dictionary used to make the request</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>counter_reqest_methods <span class="op">=</span> {<span class="st">&#39;method&#39;</span>: <span class="st">&#39;GetAllCounters&#39;</span>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the GetAllCounters request to memory</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>counter_reqest_methods)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>response</span></code></pre></div>
<pre><code>## &lt;Response [200]&gt;</code></pre>
<p>Great! Response [200] means we got an OK response back. When making a GET request, a ‘response object’ will be returned. Let’s take a look at what’s inside our response object. Use the .text method as shown below to look at the data inside our response object. The output is a mess of HTML so I’ll leave it to you to take a look at it yourself.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>response.text</span></code></pre></div>
</div>
<div id="step-2-clean-the-data" class="section level2">
<h2>Step 2: Clean the Data</h2>
<p>We will use the ‘re’ module to remove some of the extraneous html. From the official Python documentation, “This module provides regular expression matching operations…” A great tutorial on Regular Expressions (RegEx) can be found <a href="https://realpython.com/regex-python/">here</a></p>
<p>The code below will substitute any ‘’ or ‘ with a blank string (’’), essentially deleting them.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>string_data <span class="op">=</span> response.text</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>clean_string_data <span class="op">=</span> re.sub(<span class="vs">r&#39;[\n|\t]&#39;</span>, <span class="st">&#39;&#39;</span>, string_data)</span></code></pre></div>
<p>Now it’s easier to read! The first part of the data mentions that the data is in XML format. We can use this to our advantage by converting the string to an XML to easily pull out the data we are looking for.</p>
</div>
<div id="step-3-convert-data-to-xml" class="section level2">
<h2>Step 3: Convert data to XML</h2>
<p>We will use the module ‘xml.etree.ElementTree’ to convert the data from a string to XML format. By converting this to XML, finding the data we need will be faster because we don’t have to iterate over the entire string looking for the specific data we need, we can use the hierarchical structure of an XML file to drill down to the specific data we are looking for.</p>
<p>To make it easier to call, we will import the module as ‘ET’. We will then call the function ‘fromstring’ and pass in our ‘clean_string_data’ as an argument.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> ET.fromstring(clean_string_data)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(root)</span></code></pre></div>
<pre><code>## &lt;class &#39;xml.etree.ElementTree.Element&#39;&gt;</code></pre>
<p>Our object ‘root’ is now an ‘xml.etree.ElementTree.Element’ object that we can iterate over with a <strong>for loop</strong> or we can use the <strong>list</strong> function.</p>
</div>
<div id="step-4-explore-xml-data" class="section level2">
<h2>Step 4: Explore XML Data</h2>
<p>Using the <strong>list</strong> function allows us to take a look inside <strong>root</strong> to see its children.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(root)</span></code></pre></div>
<pre><code>## [&lt;Element &#39;counter&#39; at 0x0000000029DCC778&gt;, &lt;Element &#39;counter&#39; at 0x00000000120729A8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012072CC8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012078048&gt;, &lt;Element &#39;counter&#39; at 0x0000000012078368&gt;, &lt;Element &#39;counter&#39; at 0x0000000012078688&gt;, &lt;Element &#39;counter&#39; at 0x00000000120789A8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012078D18&gt;, &lt;Element &#39;counter&#39; at 0x000000001207B0E8&gt;, &lt;Element &#39;counter&#39; at 0x000000001207B408&gt;, &lt;Element &#39;counter&#39; at 0x000000001207B728&gt;, &lt;Element &#39;counter&#39; at 0x000000001207BA48&gt;, &lt;Element &#39;counter&#39; at 0x000000001207BD68&gt;, &lt;Element &#39;counter&#39; at 0x000000001207C0E8&gt;, &lt;Element &#39;counter&#39; at 0x000000001207C408&gt;, &lt;Element &#39;counter&#39; at 0x000000001207C728&gt;, &lt;Element &#39;counter&#39; at 0x000000001207CA48&gt;, &lt;Element &#39;counter&#39; at 0x000000001207CD68&gt;, &lt;Element &#39;counter&#39; at 0x000000001207E0E8&gt;, &lt;Element &#39;counter&#39; at 0x000000001207E408&gt;, &lt;Element &#39;counter&#39; at 0x000000001207E728&gt;, &lt;Element &#39;counter&#39; at 0x000000001207EA48&gt;, &lt;Element &#39;counter&#39; at 0x000000001207ED68&gt;, &lt;Element &#39;counter&#39; at 0x00000000120810E8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012081408&gt;, &lt;Element &#39;counter&#39; at 0x0000000012081728&gt;, &lt;Element &#39;counter&#39; at 0x0000000012081A48&gt;, &lt;Element &#39;counter&#39; at 0x0000000012081D68&gt;, &lt;Element &#39;counter&#39; at 0x00000000120840E8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012084408&gt;, &lt;Element &#39;counter&#39; at 0x0000000012084728&gt;, &lt;Element &#39;counter&#39; at 0x0000000012084A48&gt;, &lt;Element &#39;counter&#39; at 0x0000000012084DB8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012087138&gt;, &lt;Element &#39;counter&#39; at 0x0000000012087458&gt;, &lt;Element &#39;counter&#39; at 0x0000000012087778&gt;, &lt;Element &#39;counter&#39; at 0x0000000012087A98&gt;, &lt;Element &#39;counter&#39; at 0x0000000012087DB8&gt;, &lt;Element &#39;counter&#39; at 0x0000000012082138&gt;, &lt;Element &#39;counter&#39; at 0x0000000012082458&gt;, &lt;Element &#39;counter&#39; at 0x0000000012082778&gt;, &lt;Element &#39;counter&#39; at 0x0000000012082A98&gt;, &lt;Element &#39;counter&#39; at 0x0000000012082DB8&gt;, &lt;Element &#39;counter&#39; at 0x000000001208A138&gt;, &lt;Element &#39;counter&#39; at 0x000000001208A458&gt;, &lt;Element &#39;counter&#39; at 0x000000001208A778&gt;, &lt;Element &#39;counter&#39; at 0x000000001208AA98&gt;, &lt;Element &#39;counter&#39; at 0x000000001208ADB8&gt;, &lt;Element &#39;counter&#39; at 0x000000001208C138&gt;]</code></pre>
<p>We can see there are a lot of “Element ‘counter’…” objects, each representing a different Bikeometer with details of its own.</p>
<p>Now, we could go in blind and do lots of slicing to see the hierarchy of the file but realistically we have access to a web browser and can use the below URL to make the API call and see where the data that we need is located.</p>
<p><a href="http://webservices.commuterpage.com/counters.cfc?wsdl&amp;method=GetAllCounters" class="uri">http://webservices.commuterpage.com/counters.cfc?wsdl&amp;method=GetAllCounters</a></p>
<p>Let’s slice into the list of counters and assign the first counter to the variable ‘child’ then take a look inside.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>child <span class="op">=</span> root[<span class="dv">0</span>]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(child)</span></code></pre></div>
<pre><code>## [&lt;Element &#39;name&#39; at 0x000000001206A1D8&gt;, &lt;Element &#39;description&#39; at 0x000000001206A228&gt;, &lt;Element &#39;trail_id&#39; at 0x000000001206A868&gt;, &lt;Element &#39;trail_name&#39; at 0x00000000120727C8&gt;, &lt;Element &#39;latitude&#39; at 0x0000000012072818&gt;, &lt;Element &#39;longitude&#39; at 0x0000000012072868&gt;, &lt;Element &#39;region&#39; at 0x00000000120728B8&gt;]</code></pre>
<p>We can see that ‘child’ contains many elements that we can access such as name, description, trail_id…etc.</p>
<p>However, we also know that ‘child’ contains the information for ‘id’. Let’s access that ‘id’ information.</p>
<p>We can use the <strong>items</strong> method to return a list of a single tuple.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>child.items()</span></code></pre></div>
<pre><code>## [(&#39;id&#39;, &#39;33&#39;)]</code></pre>
<p>However, we really want to isolate the important information ‘33’.</p>
<p>So, We can use the <strong>keys</strong> method to even though this is not a dictionary.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>child.keys()</span></code></pre></div>
<pre><code>## [&#39;id&#39;]</code></pre>
<p>We know that the <strong>key</strong> is so we can use the <strong>get</strong> method and pass in ‘id’ to get the “value”.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>child.get(<span class="st">&#39;id&#39;</span>)</span></code></pre></div>
<pre><code>## &#39;33&#39;</code></pre>
<p>To access the ‘name’ element we will slice into the list and access the first object. We will assign that object to the variable ‘grandchild’.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>grandchild <span class="op">=</span> child[<span class="dv">0</span>]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>grandchild</span></code></pre></div>
<pre><code>## &lt;Element &#39;name&#39; at 0x000000001206A1D8&gt;</code></pre>
<p>Now that we have the ‘name’ object assigned, let’s see what the name of the first Bikeometer in our XML file is.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>grandchild.text</span></code></pre></div>
<pre><code>## &#39;110 Trail&#39;</code></pre>
<p>‘110 Trail’ is the name! If you want, try pulling some data yourself. Below, I describe how I automated pulling the data.</p>
</div>
<div id="step-5-automate-with-a-function" class="section level2">
<h2>Step 5: Automate With A Function</h2>
<p>In order to automate pulling all this data, I’ll create a <strong>for loop</strong> to iterate through the XML data. Each Bikeometer’s data will be saved in a tuple and those tuples will be saved all together in a list.</p>
<p>First, I’ll create the empty list that will house the Bikeometer tuples.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>bikeometer_details <span class="op">=</span> []</span></code></pre></div>
<p>Next, I’ll create a function with a Russian nesting doll of a <strong>for loop</strong> to dive into the appropriate sections to pull the information I want. You’ll notice I don’t pull a filed if it is ‘None’, ‘description’, ‘trail_id’, or ‘trail_name’ but you can pull this data if you want.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the children, grandchildren, and great-grandchildren and grab req data  </span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_bikeometer_details():</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> child <span class="kw">in</span> root:</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>      <span class="co"># From child &#39;counter&#39; gets the attribute &#39;id&#39; of the counter and adds it to single_list</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>      single_list <span class="op">=</span> [child.get(<span class="st">&#39;id&#39;</span>)]</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Loops through the grandchildren of root</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> grandchild <span class="kw">in</span> <span class="bu">list</span>(child):   </span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> grandchild.text <span class="op">!=</span> <span class="va">None</span> <span class="kw">and</span> grandchild.tag <span class="op">!=</span> <span class="st">&#39;description&#39;</span> <span class="kw">and</span> grandchild.tag <span class="op">!=</span> <span class="st">&#39;trail_id&#39;</span> <span class="kw">and</span> grandchild.tag <span class="op">!=</span> <span class="st">&#39;trail_name&#39;</span>:</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>              <span class="co"># If the grandchild is region, loop through region and grab the grandchildren data</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>              <span class="cf">if</span> grandchild.tag <span class="op">==</span> <span class="st">&#39;region&#39;</span>:  </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">for</span> great_grandchild <span class="kw">in</span> <span class="bu">list</span>(grandchild): </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>                      single_list.append(great_grandchild.text)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>              <span class="co"># If the grandchild is not region, the data is available in grandchild.text</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>              <span class="cf">else</span>: </span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>                  single_list.append(grandchild.text)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Cast the list into a tuple making it easier to migrate data to the database</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>      single_tuple <span class="op">=</span> <span class="bu">tuple</span>(single_list)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Appends tuples to the list</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      bikeometer_details.append(single_tuple)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>get_bikeometer_details()</span></code></pre></div>
<p>Taking a look inside our bikeometer_details object, we see a list of tuples, where each tuple is a seperate Bikeometer.</p>
<p>Each tuple contains: (‘bikeometer_id’, ‘bikeometer_name’, ‘latitude’, ‘longitude’, ‘region’, ‘region_id’)</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>bikeometer_details</span></code></pre></div>
<pre><code>## [(&#39;33&#39;, &#39;110 Trail&#39;, &#39;38.885315&#39;, &#39;-77.065022&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;30&#39;, &#39;14th Street Bridge&#39;, &#39;38.874260&#39;, &#39;-77.044610&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;43&#39;, &#39;15th Street NW&#39;, &#39;38.907470&#39;, &#39;-77.034610&#39;, &#39;DC&#39;, &#39;3&#39;), (&#39;24&#39;, &#39;Ballston Connector&#39;, &#39;38.882950&#39;, &#39;-77.121235&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;59&#39;, &#39;Bluemont Connector&#39;, &#39;38.880440&#39;, &#39;-77.119290&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;56&#39;, &#39;BWP Counter&#39;, &#39;38.933140&#39;, &#39;-76.938320&#39;, &quot;Prince George&#39;s County&quot;, &#39;5&#39;), (&#39;47&#39;, &#39;Capital Crescent Trail #1&#39;, &#39;38.979500&#39;, &#39;-77.096760&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;48&#39;, &#39;Capital Crescent Trail #2&#39;, &#39;38.943070&#39;, &#39;-77.115660&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;10&#39;, &#39;CC Connector&#39;, &#39;38.857702&#39;, &#39;-77.047373&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;20&#39;, &#39;Clarendon EB bike lane&#39;, &#39;38.888780&#39;, &#39;-77.090421&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;35&#39;, &#39;Commonwealth Bike Lanes&#39;, &#39;38.831730&#39;, &#39;-77.059280&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;57&#39;, &#39;Cottage City Counter&#39;, &#39;38.939700&#39;, &#39;-76.944710&#39;, &quot;Prince George&#39;s County&quot;, &#39;5&#39;), (&#39;18&#39;, &#39;Crystal NB bike lane&#39;, &#39;38.857315&#39;, &#39;-77.049152&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;3&#39;, &#39;Custis Bon Air Park&#39;, &#39;38.879199&#39;, &#39;-77.138420&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;58&#39;, &#39;Custis Rosslyn&#39;, &#39;38.897110&#39;, &#39;-77.083410&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;61&#39;, &#39;Eads NB&#39;, &#39;38.857970&#39;, &#39;-77.053040&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;62&#39;, &#39;Eads SB&#39;, &#39;38.859450&#39;, &#39;-77.053500&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;38&#39;, &#39;Eisenhower Trail&#39;, &#39;38.802950&#39;, &#39;-77.088350&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;44&#39;, &#39;Eye Street SW&#39;, &#39;38.879260&#39;, &#39;-77.015580&#39;, &#39;DC&#39;, &#39;3&#39;), (&#39;14&#39;, &#39;Fairfax EB bike lane&#39;, &#39;38.882767&#39;, &#39;-77.104615&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;60&#39;, &#39;Fairfax WB&#39;, &#39;38.883330&#39;, &#39;-77.103780&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;5&#39;, &#39;Four Mile Run (piezo)&#39;, &#39;38.843262&#39;, &#39;-77.080860&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;6&#39;, &#39;Four Mile Run (pyro)&#39;, &#39;38.843353&#39;, &#39;-77.080581&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;42&#39;, &#39;Four Mile Trail&#39;, &#39;38.840070&#39;, &#39;-77.053290&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;37&#39;, &#39;Holmes Run Trail&#39;, &#39;38.817830&#39;, &#39;-77.123570&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;27&#39;, &#39;Joyce St NB&#39;, &#39;38.867264&#39;, &#39;-77.062829&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;26&#39;, &#39;Joyce St SB&#39;, &#39;38.867271&#39;, &#39;-77.063054&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;8&#39;, &#39;Key Bridge East&#39;, &#39;38.900468&#39;, &#39;-77.070656&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;7&#39;, &#39;Key Bridge West&#39;, &#39;38.900539&#39;, &#39;-77.070900&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;51&#39;, &#39;Matthew Henson Trail 1&#39;, &#39;39.081660&#39;, &#39;-77.047360&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;52&#39;, &#39;Matthew Henson Trail 2&#39;, &#39;39.058320&#39;, &#39;-77.091600&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;45&#39;, &#39;Metropolitan Branch Trail North&#39;, &#39;38.923040&#39;, &#39;-76.995700&#39;, &#39;DC&#39;, &#39;3&#39;), (&#39;22&#39;, &#39;Military NB bike lane&#39;, &#39;38.905509&#39;, &#39;-77.109349&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;21&#39;, &#39;Military SB bike lane&#39;, &#39;38.905732&#39;, &#39;-77.109698&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;36&#39;, &#39;Mount Vernon Trail #1&#39;, &#39;38.839570&#39;, &#39;-77.046630&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;34&#39;, &#39;Mount Vernon Trail #2&#39;, &#39;38.827310&#39;, &#39;-77.042830&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;41&#39;, &#39;Mount Vernon Trail #3&#39;, &#39;38.790290&#39;, &#39;-77.050940&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;9&#39;, &#39;MVT Airport South&#39;, &#39;38.844471&#39;, &#39;-77.048923&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;39&#39;, &#39;Potomac Yard Trail #1&#39;, &#39;38.829850&#39;, &#39;-77.047850&#39;, &#39;Alexandria&#39;, &#39;2&#39;), (&#39;16&#39;, &#39;Quincy NB bike lane&#39;, &#39;38.885457&#39;, &#39;-77.108055&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;15&#39;, &#39;Quincy SB bike lane&#39;, &#39;38.884877&#39;, &#39;-77.108075&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;54&#39;, &#39;Rock Creek Trail 1&#39;, &#39;39.016130&#39;, &#39;-77.094200&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;55&#39;, &#39;Rock Creek Trail 2&#39;, &#39;39.090260&#39;, &#39;-77.113820&#39;, &#39;Montgomery County&#39;, &#39;4&#39;), (&#39;31&#39;, &#39;Roosevelt Bridge&#39;, &#39;38.893822&#39;, &#39;-77.065737&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;28&#39;, &#39;Rosslyn Bikeometer&#39;, &#39;38.899080&#39;, &#39;-77.070980&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;11&#39;, &#39;TR Island Bridge&#39;, &#39;38.897960&#39;, &#39;-77.067721&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;2&#39;, &#39;W&amp;OD Bon Air Park&#39;, &#39;38.878949&#39;, &#39;-77.138546&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;25&#39;, &#39;W&amp;OD Bon Air West&#39;, &#39;38.879330&#39;, &#39;-77.139250&#39;, &#39;Arlington&#39;, &#39;1&#39;), (&#39;19&#39;, &#39;Wilson WB bike lane&#39;, &#39;38.889855&#39;, &#39;-77.090175&#39;, &#39;Arlington&#39;, &#39;1&#39;)]</code></pre>
</div>
<div id="step-6-data-into-a-data-frame" class="section level2">
<h2>Step 6: Data into a data frame</h2>
<p>First, we will load that <strong>Pandas</strong> module so we can turn our list of tuples into a data frame.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<p>Next, we will define the columns of the data frame according to the data in our tuples.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> (<span class="st">&#39;bikeometer_id&#39;</span>, <span class="st">&#39;name&#39;</span>, <span class="st">&#39;latitude&#39;</span>, <span class="st">&#39;longitude&#39;</span>, <span class="st">&#39;region&#39;</span>, <span class="st">&#39;region_id&#39;</span>)</span></code></pre></div>
<p>With our columns defined, we will create a dataframe using the <strong>Pandas DataFrame</strong> function, pass in our <strong>bikeometer_details</strong> list into the <strong>data</strong> parameter and pass in our <strong>columns</strong> variable to the <strong>columns</strong> parameter.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>bikeometer_details, columns <span class="op">=</span> columns)</span></code></pre></div>
<p>Finally, we will assign a <em>type</em> to each column by using the <strong>.astype()</strong> method.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;name&quot;</span>, <span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&#39;region_id&#39;</span>]] <span class="op">=</span> df[[<span class="st">&quot;name&quot;</span>, <span class="st">&quot;latitude&quot;</span>, <span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;region&quot;</span>, <span class="st">&#39;region_id&#39;</span>]].astype(<span class="st">&#39;str&#39;</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>df[[<span class="st">&quot;bikeometer_id&quot;</span>]] <span class="op">=</span> df[[<span class="st">&quot;bikeometer_id&quot;</span>]].astype(<span class="st">&#39;int&#39;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##     bikeometer_id  ... region_id
## 0              33  ...         1
## 1              30  ...         1
## 2              43  ...         3
## 3              24  ...         1
## 4              59  ...         1
## 5              56  ...         5
## 6              47  ...         4
## 7              48  ...         4
## 8              10  ...         1
## 9              20  ...         1
## 10             35  ...         2
## 11             57  ...         5
## 12             18  ...         1
## 13              3  ...         1
## 14             58  ...         1
## 15             61  ...         1
## 16             62  ...         1
## 17             38  ...         2
## 18             44  ...         3
## 19             14  ...         1
## 20             60  ...         1
## 21              5  ...         1
## 22              6  ...         1
## 23             42  ...         2
## 24             37  ...         2
## 25             27  ...         1
## 26             26  ...         1
## 27              8  ...         1
## 28              7  ...         1
## 29             51  ...         4
## 30             52  ...         4
## 31             45  ...         3
## 32             22  ...         1
## 33             21  ...         1
## 34             36  ...         2
## 35             34  ...         2
## 36             41  ...         2
## 37              9  ...         1
## 38             39  ...         2
## 39             16  ...         1
## 40             15  ...         1
## 41             54  ...         4
## 42             55  ...         4
## 43             31  ...         1
## 44             28  ...         1
## 45             11  ...         1
## 46              2  ...         1
## 47             25  ...         1
## 48             19  ...         1
## 
## [49 rows x 6 columns]</code></pre>
<p>Now that it’s in a data frame, we have many options about what to do with it. We can picke it for later, manipulate it with pandas, or what I’m going to do in the next post: save it in my database.</p>
<p>Now that we can easily pull the Bikeometer data to usable format, we will pull the data for the actual daily bike counts.</p>
</div>
</div>
<div id="requesting-bike-counts" class="section level1">
<h1>Requesting Bike Counts</h1>
<div id="step-1-make-a-request-1" class="section level2">
<h2>Step 1: Make a request</h2>
<p>Again, let’s look to the <a href="http://counters.bikearlington.com/bike/assets/File/Regional_bikearlington_webservices.pdf">API documentation</a> to find the method we need to request the Bike counts.</p>
<p>We will us the method ‘GetCountInDateRange’, pass in the dates that we are looking for, and pull out the data that we want: Bikeometer ID, Date, Direction (Inbound or Outbound), Count.</p>
<p>Note: The Bike Arlington API allows for queries of 1 year or less. This limitation can be managed by making requests in 1 year increments and adding them to the database or concatenating each 1 year request into a list.</p>
<p>Again, we’ll use the ‘requests’ library to make a ‘GET’ request to the base Bike Arlington URL and this time pass in the ‘GetCountInDateRange’ method as a parameter.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the url of the </span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&#39;http://webservices.commuterpage.com/counters.cfc?wsdl&#39;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Defines the method in a dictionary used to make the request</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>counter_reqest_methods <span class="op">=</span> {<span class="st">&#39;method&#39;</span>: <span class="st">&#39;GetCountInDateRange&#39;</span>}</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the GetAllCounters request to memory</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>counter_reqest_methods)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>response</span></code></pre></div>
<pre><code>## &lt;Response [200]&gt;</code></pre>
<p>Perfect, response [200]! Let’s take a look inside our ‘response object’ by using the <strong>.text</strong></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>response.text</span></code></pre></div>
<pre><code>## &#39;\r\n\t\t\t&lt;error&gt;\r\n\t \t\t\t&lt;message&gt;The COUNTERID parameter to the GetCountInDateRange function is required but was not passed in.&lt;/message&gt;\r\n\t\t\t\t&lt;detail&gt;&lt;/detail&gt;\r\n\t\t\t&lt;/error&gt;\r\n\t\t&#39;</code></pre>
<p>It looks like we’re missing some parameters… which makes sense. If we take a look at the documenation, it says:</p>
<p>"Request Fields: • CounterID – Number Required Field • startDate – mm/dd/yyyy • endDate – mm/dd/yyyy • direction – I, O (I: Inbound, O: outbound), Empty for both. • mode – B, P (B: bike, P: pesdestrian), empty for both. • startTime – HH:MM format • endtime – HH:MM format • interval – h (by the hourly), m(by the minutes), d(by the day</p>
<p>Example with interval as d: <a href="http://webservices.commuterpage.com/counters.cfc?wsdl&amp;method=GetCountInDateRan" class="uri">http://webservices.commuterpage.com/counters.cfc?wsdl&amp;method=GetCountInDateRan</a> ge&amp;counterid=1&amp;startDate=12/1/2011&amp;endDate=12/04/2011&amp;direction=I&amp;mode=B&amp;inte rval=d"</p>
<p>Like with many parts of coding, there are multiple ways to achieve the same goal. We could create a function that concatenates a URL according to our desired ‘request fields’, or we can do what I do below: pass in each of the request fields to the GET request.</p>
<p>I’ll start with the first ‘bikeometer_id’ in the above Bikeometer Details data frame, so counterID = 33. To get the ‘start date’, let’s use one of the built-in Bike Arlington API methods: ‘getMinDates’</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the url of the </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">&#39;http://webservices.commuterpage.com/counters.cfc?wsdl&#39;</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Defines the method in a dictionary used to make the request</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>counter_reqest_methods <span class="op">=</span> {<span class="st">&#39;method&#39;</span>: <span class="st">&#39;getMinDates&#39;</span>, <span class="st">&#39;counterID&#39;</span>: <span class="st">&#39;33&#39;</span>}</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the GetAllCounters request to memory</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>counter_reqest_methods)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>response.text</span></code></pre></div>
<pre><code>## &quot;&lt;wddxPacket version=&#39;1.0&#39;&gt;&lt;header/&gt;&lt;data&gt;&lt;struct&gt;&lt;var name=&#39;STARTDATE&#39;&gt;&lt;string&gt;07/22/2015&lt;/string&gt;&lt;/var&gt;&lt;/struct&gt;&lt;/data&gt;&lt;/wddxPacket&gt;&quot;</code></pre>
<p>The first date for Bikeometer 33 is 07/22/2015.</p>
<p>Just to test, let’s make the end date the same as the start date, 07/22/2015. For ‘mode’, we have the option to request data for Bikers, Pedestrians, or Both. I’ll choose Bikers, so the mode will be ‘B’. For ‘interval’ we can choose ‘minute’, ‘hourly’, or ‘daily’. I’ll choose ‘daily’. I’ll leave ‘direction’ blank to pull both the Inbound and Outbound direction.</p>
<p>We will organize all these parameters in a dictionary and pass that dictionary to the GET method.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>request_parameters <span class="op">=</span> {<span class="st">&#39;method&#39;</span>: <span class="st">&#39;GetCountInDateRange&#39;</span>,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;counterID&#39;</span>: <span class="st">&#39;33&#39;</span>,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;startDate&#39;</span>: <span class="st">&#39;07/22/2015&#39;</span> ,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;endDate&#39;</span>: <span class="st">&#39;07/22/2015&#39;</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;mode&#39;</span>: <span class="st">&#39;B&#39;</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;interval&#39;</span>: <span class="st">&#39;D&#39;</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;direction&#39;</span>: <span class="st">&#39;&#39;</span>}</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>response <span class="op">=</span> requests.get(url, params<span class="op">=</span>request_parameters)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>response.text</span></code></pre></div>
<pre><code>## &#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;\n&lt;counts counter=&quot;33&quot; endDate=&quot;7/22/2015&quot; startDate=&quot;7/22/2015&quot;&gt; \n\t\t&lt;count count=&quot;384&quot; date=&quot;07/22/2015&quot; direction=&quot;I&quot; mode=&quot;B&quot;/&gt;\n\t\t\n\t\t&lt;count count=&quot;399&quot; date=&quot;07/22/2015&quot; direction=&quot;O&quot; mode=&quot;B&quot;/&gt;\n\t\t\n\t&lt;/counts&gt;&#39;</code></pre>
<p>It looks like on 7/22/15, there were 384 bikers in the Inbound direction and 399 bikers in the Outbound direction. Before we extract this data, let’s clean it up a little just to make our lives easier.</p>
</div>
<div id="step-2-clean-the-data-1" class="section level2">
<h2>Step 2: Clean the Data</h2>
<p>Again, we will use the ‘re’ module to remove some of the extraneous html.</p>
<p>The code below will substitute any ‘’ or ‘ with a blank string (’’), essentially deleting them.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>string_data <span class="op">=</span> response.text</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>clean_string_data <span class="op">=</span> re.sub(<span class="vs">r&#39;[\n|\t]&#39;</span>, <span class="st">&#39;&#39;</span>, string_data)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>clean_string_data</span></code></pre></div>
<pre><code>## &#39;&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;counts counter=&quot;33&quot; endDate=&quot;7/22/2015&quot; startDate=&quot;7/22/2015&quot;&gt; &lt;count count=&quot;384&quot; date=&quot;07/22/2015&quot; direction=&quot;I&quot; mode=&quot;B&quot;/&gt;&lt;count count=&quot;399&quot; date=&quot;07/22/2015&quot; direction=&quot;O&quot; mode=&quot;B&quot;/&gt;&lt;/counts&gt;&#39;</code></pre>
<p>Again, The first part of the data mentions that the data is in XML format. We can use this to our advantage by converting the string to an XML to easily pull out the data we are looking for.</p>
</div>
<div id="step-3-convert-data-to-xml-1" class="section level2">
<h2>Step 3: Convert data to XML</h2>
<p>This step is the same as above but I’ll repeat it again for those that skipped right to this step.</p>
<p>We will use the module ‘xml.etree.ElementTree’ to convert the data from a string to XML format. By converting this to XML, finding the data we need will be faster because we don’t have to iterate over the entire string looking for the specific data we need, we can use the hierarchical structure of an XML file to drill down to the specific data we are looking for.</p>
<p>To make it easier to call, we will import the module as ‘ET’. We will then call the method ‘fromstring’ and pass in our ‘clean_string_data’ as an argument.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>root <span class="op">=</span> ET.fromstring(clean_string_data)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(root)</span></code></pre></div>
<pre><code>## &lt;class &#39;xml.etree.ElementTree.Element&#39;&gt;</code></pre>
<p>Our object ‘root’ is now an ‘xml.etree.ElementTree.Element’ object that we can iterate over with a <strong>for loop</strong> or we can use the <strong>list</strong> function.</p>
</div>
<div id="step-4-explore-xml-data-1" class="section level2">
<h2>Step 4: Explore XML Data</h2>
<p>Using the <strong>list</strong> function allows us to take a look inside <strong>root</strong> to see its children.</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(root)</span></code></pre></div>
<pre><code>## [&lt;Element &#39;count&#39; at 0x00000000358B4548&gt;, &lt;Element &#39;count&#39; at 0x00000000358B42C8&gt;]</code></pre>
<p>We can see there are two “Element ‘counter’…” objects, one representing the Inbound direction and the other is the Outbound direction on our requested date.</p>
<p>Let’s slice into the list of counters and assign the first counter to the variable ‘child’ then take a look inside.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>child <span class="op">=</span> root[<span class="dv">0</span>]</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>child.items()</span></code></pre></div>
<pre><code>## [(&#39;count&#39;, &#39;384&#39;), (&#39;date&#39;, &#39;07/22/2015&#39;), (&#39;direction&#39;, &#39;I&#39;), (&#39;mode&#39;, &#39;B&#39;)]</code></pre>
<p>We can see that ‘child’ contains the ‘count’, ‘date’, ‘direction’, and ‘mode’.</p>
<p>To isolate the important information we can use the <strong>get</strong> method and pass in ‘count’, ‘date’, ‘direction’, or ‘mode’ to get the value.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>child.get(<span class="st">&#39;count&#39;</span>)</span></code></pre></div>
<pre><code>## &#39;384&#39;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>child.get(<span class="st">&#39;date&#39;</span>)</span></code></pre></div>
<pre><code>## &#39;07/22/2015&#39;</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>child.get(<span class="st">&#39;direction&#39;</span>)</span></code></pre></div>
<pre><code>## &#39;I&#39;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>child.get(<span class="st">&#39;mode&#39;</span>)</span></code></pre></div>
<pre><code>## &#39;B&#39;</code></pre>
<p>Now that we know how to pull the data that we want, let’s automate it.</p>
</div>
<div id="step-5-automate-with-a-function-1" class="section level2">
<h2>Step 5: Automate With A Function</h2>
<p>I’ll show you the function that I created to iterate through the XML data. Every ‘count’ and its details will be saved in a tuple and those tuples will be saved all together in a list.</p>
<p>First, I’ll create the empty list that will house the ‘count’ tuples.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>count_in_date_range_list <span class="op">=</span> []</span></code></pre></div>
<p>Next, I’ll create a list of the Bikeometer ID’s that I’d like to pull data for. My function will iterate over this list using a <strong>for loop</strong>.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>bikeometer_id_list <span class="op">=</span> [<span class="st">&#39;33&#39;</span>,<span class="st">&#39;30&#39;</span>,<span class="st">&#39;43&#39;</span>,<span class="st">&#39;24&#39;</span>,<span class="st">&#39;59&#39;</span>,<span class="st">&#39;56&#39;</span>,<span class="st">&#39;47&#39;</span>,<span class="st">&#39;48&#39;</span>,<span class="st">&#39;10&#39;</span>,<span class="st">&#39;20&#39;</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&#39;35&#39;</span>,<span class="st">&#39;57&#39;</span>,<span class="st">&#39;18&#39;</span>,<span class="st">&#39;3&#39;</span>,<span class="st">&#39;58&#39;</span>,<span class="st">&#39;61&#39;</span>,<span class="st">&#39;62&#39;</span>,<span class="st">&#39;38&#39;</span>,<span class="st">&#39;44&#39;</span>,<span class="st">&#39;14&#39;</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&#39;60&#39;</span>,<span class="st">&#39;5&#39;</span>,<span class="st">&#39;6&#39;</span>,<span class="st">&#39;42&#39;</span>,<span class="st">&#39;37&#39;</span>,<span class="st">&#39;27&#39;</span>,<span class="st">&#39;26&#39;</span>,<span class="st">&#39;8&#39;</span>,<span class="st">&#39;7&#39;</span>,<span class="st">&#39;51&#39;</span>,<span class="st">&#39;52&#39;</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&#39;45&#39;</span>,<span class="st">&#39;22&#39;</span>,<span class="st">&#39;21&#39;</span>,<span class="st">&#39;36&#39;</span>,<span class="st">&#39;34&#39;</span>,<span class="st">&#39;41&#39;</span>,<span class="st">&#39;9&#39;</span>,<span class="st">&#39;39&#39;</span>,<span class="st">&#39;16&#39;</span>,<span class="st">&#39;15&#39;</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                           <span class="st">&#39;54&#39;</span>,<span class="st">&#39;55&#39;</span>,<span class="st">&#39;31&#39;</span>,<span class="st">&#39;28&#39;</span>,<span class="st">&#39;11&#39;</span>,<span class="st">&#39;2&#39;</span>,<span class="st">&#39;25&#39;</span>,<span class="st">&#39;19&#39;</span>]</span></code></pre></div>
<p>Next, I’ll create a Russian nesting doll of a <strong>for loop</strong> to dive into the appropriate sections to pull the information I want. I’ll use the <strong>datetime</strong> module to separate out the</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, datetime, timedelta</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> api_counts_to_list(): </span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> bikeometer_id <span class="kw">in</span> bikeometer_id_list:</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    request_parameters <span class="op">=</span> {<span class="st">&#39;method&#39;</span>: <span class="st">&#39;GetCountInDateRange&#39;</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;counterID&#39;</span>: bikeometer_id,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;startDate&#39;</span>: <span class="st">&#39;07/22/2015&#39;</span> ,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;endDate&#39;</span>: <span class="st">&#39;07/22/2015&#39;</span>,</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;mode&#39;</span>: <span class="st">&#39;B&#39;</span>,</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;interval&#39;</span>: <span class="st">&#39;D&#39;</span>,</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&#39;direction&#39;</span>: <span class="st">&#39;&#39;</span>}</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>    response <span class="op">=</span> requests.get(url, params<span class="op">=</span>request_parameters)</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>    string_data <span class="op">=</span> response.text</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>    clean_string_data <span class="op">=</span> re.sub(<span class="vs">r&#39;[\n|\t]&#39;</span>, <span class="st">&#39;&#39;</span>, string_data)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>    root <span class="op">=</span> ET.fromstring(clean_string_data)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> type_tag <span class="kw">in</span> root.findall(<span class="st">&#39;count&#39;</span>):</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> type_tag.get(<span class="st">&#39;count&#39;</span>)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> type_tag.get(<span class="st">&#39;date&#39;</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Converts counter date to a date object</span></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a>        date <span class="op">=</span> datetime.strptime(date, <span class="st">&#39;%m/</span><span class="sc">%d</span><span class="st">/%Y&#39;</span>).date()</span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a>        year <span class="op">=</span> date.year</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        month <span class="op">=</span> date.month</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        day <span class="op">=</span> date.day</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        month_day <span class="op">=</span> <span class="ss">f&#39;</span><span class="sc">{</span>month<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>day<span class="sc">}</span><span class="ss">&#39;</span></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> type_tag.get(<span class="st">&#39;direction&#39;</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> date.weekday() <span class="op">&lt;=</span> <span class="dv">4</span>:</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>            is_weekend <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>            is_weekend <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>        single_tuple <span class="op">=</span> (bikeometer_id, date, direction, count, is_weekend, year, month, day, month_day)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>        count_in_date_range_list.append(single_tuple)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> count_in_date_range_list</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>all_id_list <span class="op">=</span> api_counts_to_list()</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>all_id_list</span></code></pre></div>
<pre><code>## [(&#39;33&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;384&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;33&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;399&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;30&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;1395&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;30&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1330&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;43&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;1125&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;43&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1359&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;24&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;210&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;24&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;238&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;10&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;467&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;10&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;490&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;20&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;256&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;18&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;9&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;3&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;758&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;3&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;771&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;44&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;275&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;44&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;0&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;14&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;213&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;27&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;31&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;27&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;6&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;26&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;15&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;26&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;24&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;8&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;505&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;8&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;993&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;7&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;718&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;7&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;204&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;45&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;1551&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;45&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1397&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;22&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;64&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;21&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;55&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;34&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;975&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;34&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;937&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;9&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;1053&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;9&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1012&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;16&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;125&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;15&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;110&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;31&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;297&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;31&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;328&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;28&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;759&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;28&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1134&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;11&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;925&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;11&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;967&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;2&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;463&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;2&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;919&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;25&#39;, datetime.date(2015, 7, 22), &#39;I&#39;, &#39;1068&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;25&#39;, datetime.date(2015, 7, 22), &#39;O&#39;, &#39;1065&#39;, 0, 2015, 7, 22, &#39;7_22&#39;), (&#39;19&#39;, datetime.date(2015, 7, 22), &#39;A&#39;, &#39;328&#39;, 0, 2015, 7, 22, &#39;7_22&#39;)]</code></pre>
<p>Each tuple contains: (bikeometer_id, date, direction, count, is_weekend, year, month, day, month_day).</p>
<p>I added a few more variables by manipulating the date a bit in order to make the analysis later easier.</p>
</div>
<div id="step-6-data-into-a-data-frame-1" class="section level2">
<h2>Step 6: Data into a data frame</h2>
<p>First, we will load that <strong>Pandas</strong> module so we can turn our list of tuples into a data frame.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
<p>Next, we will define the columns of the data frame according to the data in our tuples.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>columns <span class="op">=</span> (<span class="st">&#39;bikeometer_id&#39;</span>, <span class="st">&#39;date&#39;</span>, <span class="st">&#39;direction&#39;</span>, <span class="st">&#39;count&#39;</span>, <span class="st">&#39;is_weekend&#39;</span>, <span class="st">&#39;year&#39;</span>, <span class="st">&#39;month&#39;</span>, <span class="st">&#39;day&#39;</span>, <span class="st">&#39;month_day&#39;</span>)</span></code></pre></div>
<p>With our columns defined, we will create a dataframe using the pandas <strong>DataFrame</strong> method, pass in our <strong>bikeometer_details</strong> list into the <strong>data</strong> parameter and pass in our <strong>columns</strong> variable to the <strong>columns</strong> parameter.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame(all_id_list, columns<span class="op">=</span>columns)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##    bikeometer_id        date direction count  ...  year  month  day  month_day
## 0             33  2015-07-22         I   384  ...  2015      7   22       7_22
## 1             33  2015-07-22         O   399  ...  2015      7   22       7_22
## 2             30  2015-07-22         I  1395  ...  2015      7   22       7_22
## 3             30  2015-07-22         O  1330  ...  2015      7   22       7_22
## 4             43  2015-07-22         I  1125  ...  2015      7   22       7_22
## 5             43  2015-07-22         O  1359  ...  2015      7   22       7_22
## 6             24  2015-07-22         I   210  ...  2015      7   22       7_22
## 7             24  2015-07-22         O   238  ...  2015      7   22       7_22
## 8             10  2015-07-22         I   467  ...  2015      7   22       7_22
## 9             10  2015-07-22         O   490  ...  2015      7   22       7_22
## 10            20  2015-07-22         A   256  ...  2015      7   22       7_22
## 11            18  2015-07-22         A     9  ...  2015      7   22       7_22
## 12             3  2015-07-22         I   758  ...  2015      7   22       7_22
## 13             3  2015-07-22         O   771  ...  2015      7   22       7_22
## 14            44  2015-07-22         I   275  ...  2015      7   22       7_22
## 15            44  2015-07-22         O     0  ...  2015      7   22       7_22
## 16            14  2015-07-22         A   213  ...  2015      7   22       7_22
## 17            27  2015-07-22         I    31  ...  2015      7   22       7_22
## 18            27  2015-07-22         O     6  ...  2015      7   22       7_22
## 19            26  2015-07-22         I    15  ...  2015      7   22       7_22
## 20            26  2015-07-22         O    24  ...  2015      7   22       7_22
## 21             8  2015-07-22         I   505  ...  2015      7   22       7_22
## 22             8  2015-07-22         O   993  ...  2015      7   22       7_22
## 23             7  2015-07-22         I   718  ...  2015      7   22       7_22
## 24             7  2015-07-22         O   204  ...  2015      7   22       7_22
## 25            45  2015-07-22         I  1551  ...  2015      7   22       7_22
## 26            45  2015-07-22         O  1397  ...  2015      7   22       7_22
## 27            22  2015-07-22         A    64  ...  2015      7   22       7_22
## 28            21  2015-07-22         A    55  ...  2015      7   22       7_22
## 29            34  2015-07-22         I   975  ...  2015      7   22       7_22
## 30            34  2015-07-22         O   937  ...  2015      7   22       7_22
## 31             9  2015-07-22         I  1053  ...  2015      7   22       7_22
## 32             9  2015-07-22         O  1012  ...  2015      7   22       7_22
## 33            16  2015-07-22         A   125  ...  2015      7   22       7_22
## 34            15  2015-07-22         A   110  ...  2015      7   22       7_22
## 35            31  2015-07-22         I   297  ...  2015      7   22       7_22
## 36            31  2015-07-22         O   328  ...  2015      7   22       7_22
## 37            28  2015-07-22         I   759  ...  2015      7   22       7_22
## 38            28  2015-07-22         O  1134  ...  2015      7   22       7_22
## 39            11  2015-07-22         I   925  ...  2015      7   22       7_22
## 40            11  2015-07-22         O   967  ...  2015      7   22       7_22
## 41             2  2015-07-22         I   463  ...  2015      7   22       7_22
## 42             2  2015-07-22         O   919  ...  2015      7   22       7_22
## 43            25  2015-07-22         I  1068  ...  2015      7   22       7_22
## 44            25  2015-07-22         O  1065  ...  2015      7   22       7_22
## 45            19  2015-07-22         A   328  ...  2015      7   22       7_22
## 
## [46 rows x 9 columns]</code></pre>
<p>Now that we are able to automate pulling the data into a data frame, in the <a href="https://nathansprojects.com/part_3_setup_your_database.html">next post</a>, we can set up our database which we will use to store the data for analysis.</p>
</div>
</div>

<div id="rmd-source-code">LS0tDQp0aXRsZTogIlZpc3VhbGl6aW5nIEFybGluZ3RvbiBCaWtvbWV0ZXJzIg0Kc3VidGl0bGU6ICJQYXJ0IDI6IFF1ZXJ5IHRoZSBCaWtlIEFybGluZ3RvbiBBUEkiDQpvdXRwdXQ6DQogIGh0bWxfZG9jdW1lbnQ6IA0KICAgIHRvYzogeWVzDQogICAgdG9jX2RlcHRoOiAyDQogICAgdG9jX2Zsb2F0OiB5ZXMNCiAgICBoaWdobGlnaHQ6IHplbmJ1cm4NCiAgICBjb2RlX2Rvd25sb2FkOiB0cnVlDQogICAgaW5jbHVkZXM6DQogICAgICBpbl9oZWFkZXI6IGhlYWRlci5odG1sDQotLS0NCmBgYHtyIHNldHVwLCBpbmNsdWRlPUZBTFNFLCBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQprbml0cjo6b3B0c19jaHVuayRzZXQoY2FjaGU9VFJVRSkNCmBgYA0KXCAgICANClwgIA0KDQojIEludHJvZHVjdGlvbg0KDQpUaGUgT2ZmaWNpYWwgW0Jpa2UgQXJsaW5ndG9uXShodHRwOi8vY291bnRlcnMuYmlrZWFybGluZ3Rvbi5jb20vZGF0YS1mb3ItZGV2ZWxvcGVycy8pIEFQSSBpcyBhY2Nlc3NlZCB0aHJvdWdoIFt0aGlzIFVSTF0oaHR0cDovL3dlYnNlcnZpY2VzLmNvbW11dGVycGFnZS5jb20vY291bnRlcnMuY2ZjP3dzZGwpIHdpdGggbXVsdGlwbGUgZW5kcG9pbnRzL21ldGhvZHMgdG8gZ2V0IGV2ZXJ5dGhpbmcgZnJvbSB0aGUgbnVtYmVyIG9mIGJpa2VycyBvciBwZWRlc3RyaWFucyBwYXNzaW5nIGEgQmlrZW9tZXRlciB0aGF0IGRheSwgbG9uZ2l0dWRlL2xhdGl0dWRlIG9mIGVhY2ggQmlrZW9tZXRlciwgdG8gdGhlIHdlYXRoZXIgdGhhdCBkYXkuDQoNCiMjIEdvYWwNCg0KMS4gVXNpbmcgUHl0aG9uLCBxdWVyeSB0aGUgQmlrZSBBcmxpbmd0b24gQVBJIGZvciB0aGUgcGh5c2ljYWwgZGV0YWlscyBvZiBlYWNoIEJpa2VvbWV0ZXIgYW5kIHRoZSBjb3VudHMgb2YgbnVtYmVyIG9mIGJpa2VycyBpbiBhIGRhdGUgcmFuZ2UuIA0KMi4gSXNvbGF0ZSB0aGUgcmVxdWlyZWQgZGF0YS4NCjMuIE1vdmUgdGhlIGRhdGEgaW50byBhIHBhbmRhcyBkYXRhIGZyYW1lLg0KNC4gQ3JlYXRlIGEgUHl0aG9uIGZ1bmN0aW9uIHRoYXQgYXV0b21hdGVzIHRoZSBhYm92ZSBnb2Fscy4NCg0KIyBSZXF1ZXN0aW5nIEJpa2VvbWV0ZXIgRGV0YWlscw0KDQojIyBTdGVwIDE6IE1ha2UgYSByZXF1ZXN0DQoNCldlIGNhbiByZWFkIFtoZXJlXShodHRwOi8vY291bnRlcnMuYmlrZWFybGluZ3Rvbi5jb20vYmlrZS9hc3NldHMvRmlsZS9SZWdpb25hbF9iaWtlYXJsaW5ndG9uX3dlYnNlcnZpY2VzLnBkZikgYWJvdXQgdGhlIGRpZmZlcmVudCBtZXRob2RzIGF2YWlsYWJsZSB3aGVuIG1ha2luZyByZXF1ZXN0cyB0byB0aGUgQmlrZSBBcmxpbmd0b24gQVBJLg0KDQpGaXJzdCwgbGV0J3MgZ2V0IHNvbWUgZGV0YWlscyBvbiB0aGUgQmlrZW9tZXRlcnMgaW4gdGhlIGRhdGFiYXNlLiBUaGVyZSBpcyBhIG1ldGhvZCBsaXN0ZWQgJ0dldEFsbENvdW50ZXJzJyB0aGF0IHdpbGwgcmV0dXJuIHRoZSBkZXRhaWxzIG9mIHRoZSBiaWtlb21ldGVycyBpbiB0aGUgZGF0YWJhc2UuIEknbGwgdXNlIHRoZSAncmVxdWVzdHMnIGxpYnJhcnkgdG8gbWFrZSBhICdHRVQnIHJlcXVlc3QgdG8gdGhlIGJhc2UgQmlrZSBBcmxpbmd0b24gVVJMIGFuZCBwYXNzIGluIHRoZSAnR2V0QWxsQ291bnRlcnMnIG1ldGhvZCBhcyBhIHBhcmFtZXRlci4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQppbXBvcnQgcmVxdWVzdHMNCg0KIyBBc3NpZ24gdGhlIHVybCBvZiB0aGUgDQp1cmwgPSAnaHR0cDovL3dlYnNlcnZpY2VzLmNvbW11dGVycGFnZS5jb20vY291bnRlcnMuY2ZjP3dzZGwnDQojIERlZmluZXMgdGhlIG1ldGhvZCBpbiBhIGRpY3Rpb25hcnkgdXNlZCB0byBtYWtlIHRoZSByZXF1ZXN0DQpjb3VudGVyX3JlcWVzdF9tZXRob2RzID0geydtZXRob2QnOiAnR2V0QWxsQ291bnRlcnMnfQ0KIyBTYXZlIHRoZSBHZXRBbGxDb3VudGVycyByZXF1ZXN0IHRvIG1lbW9yeQ0KcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9Y291bnRlcl9yZXFlc3RfbWV0aG9kcykNCnJlc3BvbnNlDQpgYGANCg0KR3JlYXQhIFJlc3BvbnNlIFsyMDBdIG1lYW5zIHdlIGdvdCBhbiBPSyByZXNwb25zZSBiYWNrLiBXaGVuIG1ha2luZyBhIEdFVCByZXF1ZXN0LCBhICdyZXNwb25zZSBvYmplY3QnIHdpbGwgYmUgcmV0dXJuZWQuIExldCdzIHRha2UgYSBsb29rIGF0IHdoYXQncyBpbnNpZGUgb3VyIHJlc3BvbnNlIG9iamVjdC4gVXNlIHRoZSAudGV4dCBtZXRob2QgYXMgc2hvd24gYmVsb3cgdG8gbG9vayBhdCB0aGUgZGF0YSBpbnNpZGUgb3VyIHJlc3BvbnNlIG9iamVjdC4gVGhlIG91dHB1dCBpcyBhIG1lc3Mgb2YgSFRNTCBzbyBJJ2xsIGxlYXZlIGl0IHRvIHlvdSB0byB0YWtlIGEgbG9vayBhdCBpdCB5b3Vyc2VsZi4NCg0KYGBge3B5dGhvbiBldmFsPUZBTFNFLCBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpyZXNwb25zZS50ZXh0DQpgYGANCg0KIyMgU3RlcCAyOiBDbGVhbiB0aGUgRGF0YQ0KDQpXZSB3aWxsIHVzZSB0aGUgJ3JlJyBtb2R1bGUgdG8gcmVtb3ZlIHNvbWUgb2YgdGhlIGV4dHJhbmVvdXMgaHRtbC4gRnJvbSB0aGUgb2ZmaWNpYWwgUHl0aG9uIGRvY3VtZW50YXRpb24sICJUaGlzIG1vZHVsZSBwcm92aWRlcyByZWd1bGFyIGV4cHJlc3Npb24gbWF0Y2hpbmcgb3BlcmF0aW9ucy4uLiIgQSBncmVhdCB0dXRvcmlhbCBvbiBSZWd1bGFyIEV4cHJlc3Npb25zIChSZWdFeCkgY2FuIGJlIGZvdW5kIFtoZXJlXShodHRwczovL3JlYWxweXRob24uY29tL3JlZ2V4LXB5dGhvbi8pDQoNClRoZSBjb2RlIGJlbG93IHdpbGwgc3Vic3RpdHV0ZSBhbnkgJ1xuJyBvciAnXHQnIHdpdGggYSBibGFuayBzdHJpbmcgKCcnKSwgZXNzZW50aWFsbHkgZGVsZXRpbmcgdGhlbS4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQppbXBvcnQgcmUNCg0Kc3RyaW5nX2RhdGEgPSByZXNwb25zZS50ZXh0DQpjbGVhbl9zdHJpbmdfZGF0YSA9IHJlLnN1YihyJ1tcbnxcdF0nLCAnJywgc3RyaW5nX2RhdGEpDQpgYGANCg0KTm93IGl0J3MgZWFzaWVyIHRvIHJlYWQhIFRoZSBmaXJzdCBwYXJ0IG9mIHRoZSBkYXRhIG1lbnRpb25zIHRoYXQgdGhlIGRhdGEgaXMgaW4gWE1MIGZvcm1hdC4gV2UgY2FuIHVzZSB0aGlzIHRvIG91ciBhZHZhbnRhZ2UgYnkgY29udmVydGluZyB0aGUgc3RyaW5nIHRvIGFuIFhNTCB0byBlYXNpbHkgcHVsbCBvdXQgdGhlIGRhdGEgd2UgYXJlIGxvb2tpbmcgZm9yLg0KDQojIyBTdGVwIDM6IENvbnZlcnQgZGF0YSB0byBYTUwNCg0KV2Ugd2lsbCB1c2UgdGhlIG1vZHVsZSAneG1sLmV0cmVlLkVsZW1lbnRUcmVlJyB0byBjb252ZXJ0IHRoZSBkYXRhIGZyb20gYSBzdHJpbmcgdG8gWE1MIGZvcm1hdC4gQnkgY29udmVydGluZyB0aGlzIHRvIFhNTCwgZmluZGluZyB0aGUgZGF0YSB3ZSBuZWVkIHdpbGwgYmUgZmFzdGVyIGJlY2F1c2Ugd2UgZG9uJ3QgaGF2ZSB0byBpdGVyYXRlIG92ZXIgdGhlIGVudGlyZSBzdHJpbmcgbG9va2luZyBmb3IgdGhlIHNwZWNpZmljIGRhdGEgd2UgbmVlZCwgd2UgY2FuIHVzZSB0aGUgaGllcmFyY2hpY2FsIHN0cnVjdHVyZSBvZiBhbiBYTUwgZmlsZSB0byBkcmlsbCBkb3duIHRvIHRoZSBzcGVjaWZpYyBkYXRhIHdlIGFyZSBsb29raW5nIGZvci4NCg0KVG8gbWFrZSBpdCBlYXNpZXIgdG8gY2FsbCwgd2Ugd2lsbCBpbXBvcnQgdGhlIG1vZHVsZSBhcyAnRVQnLiBXZSB3aWxsIHRoZW4gY2FsbCB0aGUgZnVuY3Rpb24gJ2Zyb21zdHJpbmcnIGFuZCBwYXNzIGluIG91ciAnY2xlYW5fc3RyaW5nX2RhdGEnIGFzIGFuIGFyZ3VtZW50Lg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUUsIGF1dG9kZXA9VFJVRSwgY2FjaGUubGF6eT1GQUxTRX0NCmltcG9ydCB4bWwuZXRyZWUuRWxlbWVudFRyZWUgYXMgRVQNCg0Kcm9vdCA9IEVULmZyb21zdHJpbmcoY2xlYW5fc3RyaW5nX2RhdGEpDQp0eXBlKHJvb3QpDQpgYGANCg0KT3VyIG9iamVjdCAncm9vdCcgaXMgbm93IGFuICd4bWwuZXRyZWUuRWxlbWVudFRyZWUuRWxlbWVudCcgb2JqZWN0IHRoYXQgd2UgY2FuIGl0ZXJhdGUgb3ZlciB3aXRoIGEgKipmb3IgbG9vcCoqIG9yIHdlIGNhbiB1c2UgdGhlICoqbGlzdCoqIGZ1bmN0aW9uLg0KDQojIyBTdGVwIDQ6IEV4cGxvcmUgWE1MIERhdGENCg0KVXNpbmcgdGhlICoqbGlzdCoqIGZ1bmN0aW9uIGFsbG93cyB1cyB0byB0YWtlIGEgbG9vayBpbnNpZGUgKipyb290KiogdG8gc2VlIGl0cyBjaGlsZHJlbi4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpsaXN0KHJvb3QpDQpgYGANCg0KV2UgY2FuIHNlZSB0aGVyZSBhcmUgYSBsb3Qgb2YgIkVsZW1lbnQgJ2NvdW50ZXInLi4uIiBvYmplY3RzLCBlYWNoIHJlcHJlc2VudGluZyBhIGRpZmZlcmVudCBCaWtlb21ldGVyIHdpdGggZGV0YWlscyBvZiBpdHMgb3duLg0KDQpOb3csIHdlIGNvdWxkIGdvIGluIGJsaW5kIGFuZCBkbyBsb3RzIG9mIHNsaWNpbmcgdG8gc2VlIHRoZSBoaWVyYXJjaHkgb2YgdGhlIGZpbGUgYnV0IHJlYWxpc3RpY2FsbHkgd2UgaGF2ZSBhY2Nlc3MgdG8gYSB3ZWIgYnJvd3NlciBhbmQgY2FuIHVzZSB0aGUgYmVsb3cgVVJMIHRvIG1ha2UgdGhlIEFQSSBjYWxsIGFuZCBzZWUgd2hlcmUgdGhlIGRhdGEgdGhhdCB3ZSBuZWVkIGlzIGxvY2F0ZWQuDQoNCjxodHRwOi8vd2Vic2VydmljZXMuY29tbXV0ZXJwYWdlLmNvbS9jb3VudGVycy5jZmM/d3NkbCZtZXRob2Q9R2V0QWxsQ291bnRlcnM+DQoNCkxldCdzIHNsaWNlIGludG8gdGhlIGxpc3Qgb2YgY291bnRlcnMgYW5kIGFzc2lnbiB0aGUgZmlyc3QgY291bnRlciB0byB0aGUgdmFyaWFibGUgJ2NoaWxkJyB0aGVuIHRha2UgYSBsb29rIGluc2lkZS4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpjaGlsZCA9IHJvb3RbMF0NCmxpc3QoY2hpbGQpDQpgYGANCg0KV2UgY2FuIHNlZSB0aGF0ICdjaGlsZCcgY29udGFpbnMgbWFueSBlbGVtZW50cyB0aGF0IHdlIGNhbiBhY2Nlc3Mgc3VjaCBhcyBuYW1lLCBkZXNjcmlwdGlvbiwgdHJhaWxfaWQuLi5ldGMuDQoNCkhvd2V2ZXIsIHdlIGFsc28ga25vdyB0aGF0ICdjaGlsZCcgY29udGFpbnMgdGhlIGluZm9ybWF0aW9uIGZvciAnaWQnLiBMZXQncyBhY2Nlc3MgdGhhdCAnaWQnIGluZm9ybWF0aW9uLg0KDQpXZSBjYW4gdXNlIHRoZSAqKml0ZW1zKiogbWV0aG9kIHRvIHJldHVybiBhIGxpc3Qgb2YgYSBzaW5nbGUgdHVwbGUuDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRSwgYXV0b2RlcD1UUlVFLCBjYWNoZS5sYXp5PUZBTFNFfQ0KY2hpbGQuaXRlbXMoKQ0KYGBgDQoNCkhvd2V2ZXIsIHdlIHJlYWxseSB3YW50IHRvIGlzb2xhdGUgdGhlIGltcG9ydGFudCBpbmZvcm1hdGlvbiAnMzMnLg0KDQpTbywgV2UgY2FuIHVzZSB0aGUgKiprZXlzKiogbWV0aG9kIHRvIGV2ZW4gdGhvdWdoIHRoaXMgaXMgbm90IGEgZGljdGlvbmFyeS4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpjaGlsZC5rZXlzKCkNCmBgYA0KDQpXZSBrbm93IHRoYXQgdGhlICoqa2V5KiogaXMgc28gd2UgY2FuIHVzZSB0aGUgKipnZXQqKiBtZXRob2QgYW5kIHBhc3MgaW4gJ2lkJyB0byBnZXQgdGhlICJ2YWx1ZSIuDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRSwgYXV0b2RlcD1UUlVFLCBjYWNoZS5sYXp5PUZBTFNFfQ0KY2hpbGQuZ2V0KCdpZCcpDQpgYGANCg0KVG8gYWNjZXNzIHRoZSAnbmFtZScgZWxlbWVudCB3ZSB3aWxsIHNsaWNlIGludG8gdGhlIGxpc3QgYW5kIGFjY2VzcyB0aGUgZmlyc3Qgb2JqZWN0LiBXZSB3aWxsIGFzc2lnbiB0aGF0IG9iamVjdCB0byB0aGUgdmFyaWFibGUgJ2dyYW5kY2hpbGQnLg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUUsIGF1dG9kZXA9VFJVRSwgY2FjaGUubGF6eT1GQUxTRX0NCmdyYW5kY2hpbGQgPSBjaGlsZFswXQ0KZ3JhbmRjaGlsZA0KYGBgDQoNCk5vdyB0aGF0IHdlIGhhdmUgdGhlICduYW1lJyBvYmplY3QgYXNzaWduZWQsIGxldCdzIHNlZSB3aGF0IHRoZSBuYW1lIG9mIHRoZSBmaXJzdCBCaWtlb21ldGVyIGluIG91ciBYTUwgZmlsZSBpcy4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpncmFuZGNoaWxkLnRleHQNCmBgYA0KDQonMTEwIFRyYWlsJyBpcyB0aGUgbmFtZSEgSWYgeW91IHdhbnQsIHRyeSBwdWxsaW5nIHNvbWUgZGF0YSB5b3Vyc2VsZi4gQmVsb3csIEkgZGVzY3JpYmUgaG93IEkgYXV0b21hdGVkIHB1bGxpbmcgdGhlIGRhdGEuDQoNCiMjIFN0ZXAgNTogQXV0b21hdGUgV2l0aCBBIEZ1bmN0aW9uDQoNCkluIG9yZGVyIHRvIGF1dG9tYXRlIHB1bGxpbmcgYWxsIHRoaXMgZGF0YSwgSSdsbCBjcmVhdGUgYSAqKmZvciBsb29wKiogdG8gaXRlcmF0ZSB0aHJvdWdoIHRoZSBYTUwgZGF0YS4gRWFjaCBCaWtlb21ldGVyJ3MgZGF0YSB3aWxsIGJlIHNhdmVkIGluIGEgdHVwbGUgYW5kIHRob3NlIHR1cGxlcyB3aWxsIGJlIHNhdmVkIGFsbCB0b2dldGhlciBpbiBhIGxpc3QuDQoNCkZpcnN0LCBJJ2xsIGNyZWF0ZSB0aGUgZW1wdHkgbGlzdCB0aGF0IHdpbGwgaG91c2UgdGhlIEJpa2VvbWV0ZXIgdHVwbGVzLg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUUsIGF1dG9kZXA9VFJVRSwgY2FjaGUubGF6eT1GQUxTRX0NCmJpa2VvbWV0ZXJfZGV0YWlscyA9IFtdDQpgYGANCg0KTmV4dCwgSSdsbCBjcmVhdGUgYSBmdW5jdGlvbiB3aXRoIGEgUnVzc2lhbiBuZXN0aW5nIGRvbGwgb2YgYSAqKmZvciBsb29wKiogdG8gZGl2ZSBpbnRvIHRoZSBhcHByb3ByaWF0ZSBzZWN0aW9ucyB0byBwdWxsIHRoZSBpbmZvcm1hdGlvbiBJIHdhbnQuIFlvdSdsbCBub3RpY2UgSSBkb24ndCBwdWxsIGEgZmlsZWQgaWYgaXQgaXMgJ05vbmUnLCAnZGVzY3JpcHRpb24nLCAndHJhaWxfaWQnLCBvciAndHJhaWxfbmFtZScgYnV0IHlvdSBjYW4gcHVsbCB0aGlzIGRhdGEgaWYgeW91IHdhbnQuDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRSwgYXV0b2RlcD1UUlVFLCBjYWNoZS5sYXp5PUZBTFNFfQ0KIyBJdGVyYXRlIHRocm91Z2ggdGhlIGNoaWxkcmVuLCBncmFuZGNoaWxkcmVuLCBhbmQgZ3JlYXQtZ3JhbmRjaGlsZHJlbiBhbmQgZ3JhYiByZXEgZGF0YSAgDQpkZWYgZ2V0X2Jpa2VvbWV0ZXJfZGV0YWlscygpOg0KICBmb3IgY2hpbGQgaW4gcm9vdDoNCiAgICAgICMgRnJvbSBjaGlsZCAnY291bnRlcicgZ2V0cyB0aGUgYXR0cmlidXRlICdpZCcgb2YgdGhlIGNvdW50ZXIgYW5kIGFkZHMgaXQgdG8gc2luZ2xlX2xpc3QNCiAgICAgIHNpbmdsZV9saXN0ID0gW2NoaWxkLmdldCgnaWQnKV0NCiAgICAgICMgTG9vcHMgdGhyb3VnaCB0aGUgZ3JhbmRjaGlsZHJlbiBvZiByb290DQogICAgICBmb3IgZ3JhbmRjaGlsZCBpbiBsaXN0KGNoaWxkKTogICANCiAgICAgICAgICBpZiBncmFuZGNoaWxkLnRleHQgIT0gTm9uZSBhbmQgZ3JhbmRjaGlsZC50YWcgIT0gJ2Rlc2NyaXB0aW9uJyBhbmQgZ3JhbmRjaGlsZC50YWcgIT0gJ3RyYWlsX2lkJyBhbmQgZ3JhbmRjaGlsZC50YWcgIT0gJ3RyYWlsX25hbWUnOg0KICAgICAgICAgICAgICAjIElmIHRoZSBncmFuZGNoaWxkIGlzIHJlZ2lvbiwgbG9vcCB0aHJvdWdoIHJlZ2lvbiBhbmQgZ3JhYiB0aGUgZ3JhbmRjaGlsZHJlbiBkYXRhDQogICAgICAgICAgICAgIGlmIGdyYW5kY2hpbGQudGFnID09ICdyZWdpb24nOiAgDQogICAgICAgICAgICAgICAgICBmb3IgZ3JlYXRfZ3JhbmRjaGlsZCBpbiBsaXN0KGdyYW5kY2hpbGQpOiANCiAgICAgICAgICAgICAgICAgICAgICBzaW5nbGVfbGlzdC5hcHBlbmQoZ3JlYXRfZ3JhbmRjaGlsZC50ZXh0KQ0KICAgICAgICAgICAgICAjIElmIHRoZSBncmFuZGNoaWxkIGlzIG5vdCByZWdpb24sIHRoZSBkYXRhIGlzIGF2YWlsYWJsZSBpbiBncmFuZGNoaWxkLnRleHQNCiAgICAgICAgICAgICAgZWxzZTogDQogICAgICAgICAgICAgICAgICBzaW5nbGVfbGlzdC5hcHBlbmQoZ3JhbmRjaGlsZC50ZXh0KQ0KICAgICAgIyBDYXN0IHRoZSBsaXN0IGludG8gYSB0dXBsZSBtYWtpbmcgaXQgZWFzaWVyIHRvIG1pZ3JhdGUgZGF0YSB0byB0aGUgZGF0YWJhc2UNCiAgICAgIHNpbmdsZV90dXBsZSA9IHR1cGxlKHNpbmdsZV9saXN0KQ0KICAgICAgIyBBcHBlbmRzIHR1cGxlcyB0byB0aGUgbGlzdA0KICAgICAgYmlrZW9tZXRlcl9kZXRhaWxzLmFwcGVuZChzaW5nbGVfdHVwbGUpDQpnZXRfYmlrZW9tZXRlcl9kZXRhaWxzKCkNCmBgYA0KDQpUYWtpbmcgYSBsb29rIGluc2lkZSBvdXIgYmlrZW9tZXRlcl9kZXRhaWxzIG9iamVjdCwgd2Ugc2VlIGEgbGlzdCBvZiB0dXBsZXMsIHdoZXJlIGVhY2ggdHVwbGUgaXMgYSBzZXBlcmF0ZSBCaWtlb21ldGVyLg0KDQpFYWNoIHR1cGxlIGNvbnRhaW5zOiAoJ2Jpa2VvbWV0ZXJfaWQnLCAnYmlrZW9tZXRlcl9uYW1lJywgJ2xhdGl0dWRlJywgJ2xvbmdpdHVkZScsICdyZWdpb24nLCAncmVnaW9uX2lkJykNCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpiaWtlb21ldGVyX2RldGFpbHMNCmBgYA0KDQojIyBTdGVwIDY6IERhdGEgaW50byBhIGRhdGEgZnJhbWUNCg0KRmlyc3QsIHdlIHdpbGwgbG9hZCB0aGF0ICoqUGFuZGFzKiogbW9kdWxlIHNvIHdlIGNhbiB0dXJuIG91ciBsaXN0IG9mIHR1cGxlcyBpbnRvIGEgZGF0YSBmcmFtZS4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQppbXBvcnQgcGFuZGFzIGFzIHBkDQpgYGANCg0KTmV4dCwgd2Ugd2lsbCBkZWZpbmUgdGhlIGNvbHVtbnMgb2YgdGhlIGRhdGEgZnJhbWUgYWNjb3JkaW5nIHRvIHRoZSBkYXRhIGluIG91ciB0dXBsZXMuIA0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpjb2x1bW5zID0gKCdiaWtlb21ldGVyX2lkJywgJ25hbWUnLCAnbGF0aXR1ZGUnLCAnbG9uZ2l0dWRlJywgJ3JlZ2lvbicsICdyZWdpb25faWQnKQ0KYGBgDQoNCldpdGggb3VyIGNvbHVtbnMgZGVmaW5lZCwgd2Ugd2lsbCBjcmVhdGUgYSBkYXRhZnJhbWUgdXNpbmcgdGhlICoqUGFuZGFzIERhdGFGcmFtZSoqIGZ1bmN0aW9uLCBwYXNzIGluIG91ciAqKmJpa2VvbWV0ZXJfZGV0YWlscyoqIGxpc3QgaW50byB0aGUgKipkYXRhKiogcGFyYW1ldGVyIGFuZCBwYXNzIGluIG91ciAqKmNvbHVtbnMqKiB2YXJpYWJsZSB0byB0aGUgKipjb2x1bW5zKiogcGFyYW1ldGVyLg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpkZiA9IHBkLkRhdGFGcmFtZShkYXRhPWJpa2VvbWV0ZXJfZGV0YWlscywgY29sdW1ucyA9IGNvbHVtbnMpDQpgYGANCg0KRmluYWxseSwgd2Ugd2lsbCBhc3NpZ24gYSAqdHlwZSogdG8gZWFjaCBjb2x1bW4gYnkgdXNpbmcgdGhlICoqLmFzdHlwZSgpKiogbWV0aG9kLg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQpkZltbIm5hbWUiLCAibGF0aXR1ZGUiLCAibG9uZ2l0dWRlIiwgInJlZ2lvbiIsICdyZWdpb25faWQnXV0gPSBkZltbIm5hbWUiLCAibGF0aXR1ZGUiLCAibG9uZ2l0dWRlIiwgInJlZ2lvbiIsICdyZWdpb25faWQnXV0uYXN0eXBlKCdzdHInKQ0KZGZbWyJiaWtlb21ldGVyX2lkIl1dID0gZGZbWyJiaWtlb21ldGVyX2lkIl1dLmFzdHlwZSgnaW50JykNCmBgYA0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUUsIGF1dG9kZXA9VFJVRSwgY2FjaGUubGF6eT1GQUxTRX0NCmRmDQpgYGANCg0KDQpOb3cgdGhhdCBpdCdzIGluIGEgZGF0YSBmcmFtZSwgd2UgaGF2ZSBtYW55IG9wdGlvbnMgYWJvdXQgd2hhdCB0byBkbyB3aXRoIGl0LiBXZSBjYW4gcGlja2UgaXQgZm9yIGxhdGVyLCBtYW5pcHVsYXRlIGl0IHdpdGggcGFuZGFzLCBvciB3aGF0IEknbSBnb2luZyB0byBkbyBpbiB0aGUgbmV4dCBwb3N0OiBzYXZlIGl0IGluIG15IGRhdGFiYXNlLg0KDQpOb3cgdGhhdCB3ZSBjYW4gZWFzaWx5IHB1bGwgdGhlIEJpa2VvbWV0ZXIgZGF0YSB0byB1c2FibGUgZm9ybWF0LCB3ZSB3aWxsIHB1bGwgdGhlIGRhdGEgZm9yIHRoZSBhY3R1YWwgZGFpbHkgYmlrZSBjb3VudHMuIA0KDQojIFJlcXVlc3RpbmcgQmlrZSBDb3VudHMNCg0KIyMgU3RlcCAxOiBNYWtlIGEgcmVxdWVzdA0KDQpBZ2FpbiwgbGV0J3MgbG9vayB0byB0aGUgW0FQSSBkb2N1bWVudGF0aW9uXShodHRwOi8vY291bnRlcnMuYmlrZWFybGluZ3Rvbi5jb20vYmlrZS9hc3NldHMvRmlsZS9SZWdpb25hbF9iaWtlYXJsaW5ndG9uX3dlYnNlcnZpY2VzLnBkZikgdG8gZmluZCB0aGUgbWV0aG9kIHdlIG5lZWQgdG8gcmVxdWVzdCB0aGUgQmlrZSBjb3VudHMuDQoNCldlIHdpbGwgdXMgdGhlIG1ldGhvZCAnR2V0Q291bnRJbkRhdGVSYW5nZScsIHBhc3MgaW4gdGhlIGRhdGVzIHRoYXQgd2UgYXJlIGxvb2tpbmcgZm9yLCBhbmQgcHVsbCBvdXQgdGhlIGRhdGEgdGhhdCB3ZSB3YW50OiBCaWtlb21ldGVyIElELCBEYXRlLCBEaXJlY3Rpb24gKEluYm91bmQgb3IgT3V0Ym91bmQpLCBDb3VudC4NCg0KTm90ZTogVGhlIEJpa2UgQXJsaW5ndG9uIEFQSSBhbGxvd3MgZm9yIHF1ZXJpZXMgb2YgMSB5ZWFyIG9yIGxlc3MuIFRoaXMgbGltaXRhdGlvbiBjYW4gYmUgbWFuYWdlZCBieSBtYWtpbmcgcmVxdWVzdHMgaW4gMSB5ZWFyIGluY3JlbWVudHMgYW5kIGFkZGluZyB0aGVtIHRvIHRoZSBkYXRhYmFzZSBvciBjb25jYXRlbmF0aW5nIGVhY2ggMSB5ZWFyIHJlcXVlc3QgaW50byBhIGxpc3QuDQoNCkFnYWluLCB3ZSdsbCB1c2UgdGhlICdyZXF1ZXN0cycgbGlicmFyeSB0byBtYWtlIGEgJ0dFVCcgcmVxdWVzdCB0byB0aGUgYmFzZSBCaWtlIEFybGluZ3RvbiBVUkwgYW5kIHRoaXMgdGltZSBwYXNzIGluIHRoZSAnR2V0Q291bnRJbkRhdGVSYW5nZScgbWV0aG9kIGFzIGEgcGFyYW1ldGVyLiANCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFLCBhdXRvZGVwPVRSVUUsIGNhY2hlLmxhenk9RkFMU0V9DQojIEFzc2lnbiB0aGUgdXJsIG9mIHRoZSANCnVybCA9ICdodHRwOi8vd2Vic2VydmljZXMuY29tbXV0ZXJwYWdlLmNvbS9jb3VudGVycy5jZmM/d3NkbCcNCiMgRGVmaW5lcyB0aGUgbWV0aG9kIGluIGEgZGljdGlvbmFyeSB1c2VkIHRvIG1ha2UgdGhlIHJlcXVlc3QNCmNvdW50ZXJfcmVxZXN0X21ldGhvZHMgPSB7J21ldGhvZCc6ICdHZXRDb3VudEluRGF0ZVJhbmdlJ30NCiMgU2F2ZSB0aGUgR2V0QWxsQ291bnRlcnMgcmVxdWVzdCB0byBtZW1vcnkNCnJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPWNvdW50ZXJfcmVxZXN0X21ldGhvZHMpDQpyZXNwb25zZQ0KYGBgDQoNClBlcmZlY3QsIHJlc3BvbnNlIFsyMDBdISBMZXQncyB0YWtlIGEgbG9vayBpbnNpZGUgb3VyICdyZXNwb25zZSBvYmplY3QnIGJ5IHVzaW5nIHRoZSAqKi50ZXh0KioNCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KcmVzcG9uc2UudGV4dA0KYGBgDQoNCkl0IGxvb2tzIGxpa2Ugd2UncmUgbWlzc2luZyBzb21lIHBhcmFtZXRlcnMuLi4gd2hpY2ggbWFrZXMgc2Vuc2UuIElmIHdlIHRha2UgYSBsb29rIGF0IHRoZSBkb2N1bWVuYXRpb24sIGl0IHNheXM6IA0KDQoiUmVxdWVzdCBGaWVsZHM6DQrigKIgQ291bnRlcklEIOKAkyBOdW1iZXIgUmVxdWlyZWQgRmllbGQNCuKAoiBzdGFydERhdGUg4oCTIG1tL2RkL3l5eXkNCuKAoiBlbmREYXRlIOKAkyBtbS9kZC95eXl5DQrigKIgZGlyZWN0aW9uIOKAkyBJLCBPIChJOiBJbmJvdW5kLCBPOiBvdXRib3VuZCksIEVtcHR5IGZvciBib3RoLg0K4oCiIG1vZGUg4oCTIEIsIFAgKEI6IGJpa2UsIFA6IHBlc2Rlc3RyaWFuKSwgZW1wdHkgZm9yIGJvdGguDQrigKIgc3RhcnRUaW1lIOKAkyBISDpNTSBmb3JtYXQNCuKAoiBlbmR0aW1lIOKAkyBISDpNTSBmb3JtYXQNCuKAoiBpbnRlcnZhbCDigJMgaCAoYnkgdGhlIGhvdXJseSksIG0oYnkgdGhlIG1pbnV0ZXMpLCBkKGJ5IHRoZSBkYXkNCg0KRXhhbXBsZSB3aXRoIGludGVydmFsIGFzIGQ6DQpodHRwOi8vd2Vic2VydmljZXMuY29tbXV0ZXJwYWdlLmNvbS9jb3VudGVycy5jZmM/d3NkbCZtZXRob2Q9R2V0Q291bnRJbkRhdGVSYW4NCmdlJmNvdW50ZXJpZD0xJnN0YXJ0RGF0ZT0xMi8xLzIwMTEmZW5kRGF0ZT0xMi8wNC8yMDExJmRpcmVjdGlvbj1JJm1vZGU9QiZpbnRlDQpydmFsPWQiDQoNCkxpa2Ugd2l0aCBtYW55IHBhcnRzIG9mIGNvZGluZywgdGhlcmUgYXJlIG11bHRpcGxlIHdheXMgdG8gYWNoaWV2ZSB0aGUgc2FtZSBnb2FsLiBXZSBjb3VsZCBjcmVhdGUgYSBmdW5jdGlvbiB0aGF0IGNvbmNhdGVuYXRlcyBhIFVSTCBhY2NvcmRpbmcgdG8gb3VyIGRlc2lyZWQgJ3JlcXVlc3QgZmllbGRzJywgb3Igd2UgY2FuIGRvIHdoYXQgSSBkbyBiZWxvdzogcGFzcyBpbiBlYWNoIG9mIHRoZSByZXF1ZXN0IGZpZWxkcyB0byB0aGUgR0VUIHJlcXVlc3QuDQoNCkknbGwgc3RhcnQgd2l0aCB0aGUgZmlyc3QgJ2Jpa2VvbWV0ZXJfaWQnIGluIHRoZSBhYm92ZSBCaWtlb21ldGVyIERldGFpbHMgZGF0YSBmcmFtZSwgc28gY291bnRlcklEID0gMzMuIFRvIGdldCB0aGUgJ3N0YXJ0IGRhdGUnLCBsZXQncyB1c2Ugb25lIG9mIHRoZSBidWlsdC1pbiBCaWtlIEFybGluZ3RvbiBBUEkgbWV0aG9kczogJ2dldE1pbkRhdGVzJw0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUV9DQojIEFzc2lnbiB0aGUgdXJsIG9mIHRoZSANCnVybCA9ICdodHRwOi8vd2Vic2VydmljZXMuY29tbXV0ZXJwYWdlLmNvbS9jb3VudGVycy5jZmM/d3NkbCcNCiMgRGVmaW5lcyB0aGUgbWV0aG9kIGluIGEgZGljdGlvbmFyeSB1c2VkIHRvIG1ha2UgdGhlIHJlcXVlc3QNCmNvdW50ZXJfcmVxZXN0X21ldGhvZHMgPSB7J21ldGhvZCc6ICdnZXRNaW5EYXRlcycsICdjb3VudGVySUQnOiAnMzMnfQ0KIyBTYXZlIHRoZSBHZXRBbGxDb3VudGVycyByZXF1ZXN0IHRvIG1lbW9yeQ0KcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsLCBwYXJhbXM9Y291bnRlcl9yZXFlc3RfbWV0aG9kcykNCnJlc3BvbnNlLnRleHQNCmBgYA0KVGhlIGZpcnN0IGRhdGUgZm9yIEJpa2VvbWV0ZXIgMzMgaXMgMDcvMjIvMjAxNS4NCg0KSnVzdCB0byB0ZXN0LCBsZXQncyBtYWtlIHRoZSBlbmQgZGF0ZSB0aGUgc2FtZSBhcyB0aGUgc3RhcnQgZGF0ZSwgMDcvMjIvMjAxNS4gRm9yICdtb2RlJywgd2UgaGF2ZSB0aGUgb3B0aW9uIHRvIHJlcXVlc3QgZGF0YSBmb3IgQmlrZXJzLCBQZWRlc3RyaWFucywgb3IgQm90aC4gSSdsbCBjaG9vc2UgQmlrZXJzLCBzbyB0aGUgbW9kZSB3aWxsIGJlICdCJy4gRm9yICdpbnRlcnZhbCcgd2UgY2FuIGNob29zZSAnbWludXRlJywgJ2hvdXJseScsIG9yICdkYWlseScuIEknbGwgY2hvb3NlICdkYWlseScuIEknbGwgbGVhdmUgJ2RpcmVjdGlvbicgYmxhbmsgdG8gcHVsbCBib3RoIHRoZSBJbmJvdW5kIGFuZCBPdXRib3VuZCBkaXJlY3Rpb24uDQoNCldlIHdpbGwgb3JnYW5pemUgYWxsIHRoZXNlIHBhcmFtZXRlcnMgaW4gYSBkaWN0aW9uYXJ5IGFuZCBwYXNzIHRoYXQgZGljdGlvbmFyeSB0byB0aGUgR0VUIG1ldGhvZC4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KcmVxdWVzdF9wYXJhbWV0ZXJzID0geydtZXRob2QnOiAnR2V0Q291bnRJbkRhdGVSYW5nZScsDQogICAgICAgICAgICAgICAgICAgICAgJ2NvdW50ZXJJRCc6ICczMycsDQogICAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0RGF0ZSc6ICcwNy8yMi8yMDE1JyAsDQogICAgICAgICAgICAgICAgICAgICAgJ2VuZERhdGUnOiAnMDcvMjIvMjAxNScsDQogICAgICAgICAgICAgICAgICAgICAgJ21vZGUnOiAnQicsDQogICAgICAgICAgICAgICAgICAgICAgJ2ludGVydmFsJzogJ0QnLA0KICAgICAgICAgICAgICAgICAgICAgICdkaXJlY3Rpb24nOiAnJ30NCnJlc3BvbnNlID0gcmVxdWVzdHMuZ2V0KHVybCwgcGFyYW1zPXJlcXVlc3RfcGFyYW1ldGVycykNCnJlc3BvbnNlLnRleHQNCmBgYA0KSXQgbG9va3MgbGlrZSBvbiA3LzIyLzE1LCB0aGVyZSB3ZXJlIDM4NCBiaWtlcnMgaW4gdGhlIEluYm91bmQgZGlyZWN0aW9uIGFuZCAzOTkgYmlrZXJzIGluIHRoZSBPdXRib3VuZCBkaXJlY3Rpb24uIEJlZm9yZSB3ZSBleHRyYWN0IHRoaXMgZGF0YSwgbGV0J3MgY2xlYW4gaXQgdXAgYSBsaXR0bGUganVzdCB0byBtYWtlIG91ciBsaXZlcyBlYXNpZXIuDQoNCiMjIFN0ZXAgMjogQ2xlYW4gdGhlIERhdGENCg0KQWdhaW4sIHdlIHdpbGwgdXNlIHRoZSAncmUnIG1vZHVsZSB0byByZW1vdmUgc29tZSBvZiB0aGUgZXh0cmFuZW91cyBodG1sLiANCg0KVGhlIGNvZGUgYmVsb3cgd2lsbCBzdWJzdGl0dXRlIGFueSAnXG4nIG9yICdcdCcgd2l0aCBhIGJsYW5rIHN0cmluZyAoJycpLCBlc3NlbnRpYWxseSBkZWxldGluZyB0aGVtLg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUV9DQppbXBvcnQgcmUNCg0Kc3RyaW5nX2RhdGEgPSByZXNwb25zZS50ZXh0DQpjbGVhbl9zdHJpbmdfZGF0YSA9IHJlLnN1YihyJ1tcbnxcdF0nLCAnJywgc3RyaW5nX2RhdGEpDQpjbGVhbl9zdHJpbmdfZGF0YQ0KYGBgDQoNCkFnYWluLCBUaGUgZmlyc3QgcGFydCBvZiB0aGUgZGF0YSBtZW50aW9ucyB0aGF0IHRoZSBkYXRhIGlzIGluIFhNTCBmb3JtYXQuIFdlIGNhbiB1c2UgdGhpcyB0byBvdXIgYWR2YW50YWdlIGJ5IGNvbnZlcnRpbmcgdGhlIHN0cmluZyB0byBhbiBYTUwgdG8gZWFzaWx5IHB1bGwgb3V0IHRoZSBkYXRhIHdlIGFyZSBsb29raW5nIGZvci4NCg0KIyMgU3RlcCAzOiBDb252ZXJ0IGRhdGEgdG8gWE1MDQoNClRoaXMgc3RlcCBpcyB0aGUgc2FtZSBhcyBhYm92ZSBidXQgSSdsbCByZXBlYXQgaXQgYWdhaW4gZm9yIHRob3NlIHRoYXQgc2tpcHBlZCByaWdodCB0byB0aGlzIHN0ZXAuIA0KDQpXZSB3aWxsIHVzZSB0aGUgbW9kdWxlICd4bWwuZXRyZWUuRWxlbWVudFRyZWUnIHRvIGNvbnZlcnQgdGhlIGRhdGEgZnJvbSBhIHN0cmluZyB0byBYTUwgZm9ybWF0LiBCeSBjb252ZXJ0aW5nIHRoaXMgdG8gWE1MLCBmaW5kaW5nIHRoZSBkYXRhIHdlIG5lZWQgd2lsbCBiZSBmYXN0ZXIgYmVjYXVzZSB3ZSBkb24ndCBoYXZlIHRvIGl0ZXJhdGUgb3ZlciB0aGUgZW50aXJlIHN0cmluZyBsb29raW5nIGZvciB0aGUgc3BlY2lmaWMgZGF0YSB3ZSBuZWVkLCB3ZSBjYW4gdXNlIHRoZSBoaWVyYXJjaGljYWwgc3RydWN0dXJlIG9mIGFuIFhNTCBmaWxlIHRvIGRyaWxsIGRvd24gdG8gdGhlIHNwZWNpZmljIGRhdGEgd2UgYXJlIGxvb2tpbmcgZm9yLg0KDQpUbyBtYWtlIGl0IGVhc2llciB0byBjYWxsLCB3ZSB3aWxsIGltcG9ydCB0aGUgbW9kdWxlIGFzICdFVCcuIFdlIHdpbGwgdGhlbiBjYWxsIHRoZSBtZXRob2QgJ2Zyb21zdHJpbmcnIGFuZCBwYXNzIGluIG91ciAnY2xlYW5fc3RyaW5nX2RhdGEnIGFzIGFuIGFyZ3VtZW50Lg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUV9DQppbXBvcnQgeG1sLmV0cmVlLkVsZW1lbnRUcmVlIGFzIEVUDQoNCnJvb3QgPSBFVC5mcm9tc3RyaW5nKGNsZWFuX3N0cmluZ19kYXRhKQ0KdHlwZShyb290KQ0KYGBgDQoNCk91ciBvYmplY3QgJ3Jvb3QnIGlzIG5vdyBhbiAneG1sLmV0cmVlLkVsZW1lbnRUcmVlLkVsZW1lbnQnIG9iamVjdCB0aGF0IHdlIGNhbiBpdGVyYXRlIG92ZXIgd2l0aCBhICoqZm9yIGxvb3AqKiBvciB3ZSBjYW4gdXNlIHRoZSAqKmxpc3QqKiBmdW5jdGlvbi4NCg0KIyMgU3RlcCA0OiBFeHBsb3JlIFhNTCBEYXRhDQoNClVzaW5nIHRoZSAqKmxpc3QqKiBmdW5jdGlvbiBhbGxvd3MgdXMgdG8gdGFrZSBhIGxvb2sgaW5zaWRlICoqcm9vdCoqIHRvIHNlZSBpdHMgY2hpbGRyZW4uDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRX0NCmxpc3Qocm9vdCkNCmBgYA0KDQpXZSBjYW4gc2VlIHRoZXJlIGFyZSB0d28gIkVsZW1lbnQgJ2NvdW50ZXInLi4uIiBvYmplY3RzLCBvbmUgcmVwcmVzZW50aW5nIHRoZSBJbmJvdW5kIGRpcmVjdGlvbiBhbmQgdGhlIG90aGVyIGlzIHRoZSBPdXRib3VuZCBkaXJlY3Rpb24gb24gb3VyIHJlcXVlc3RlZCBkYXRlLg0KDQpMZXQncyBzbGljZSBpbnRvIHRoZSBsaXN0IG9mIGNvdW50ZXJzIGFuZCBhc3NpZ24gdGhlIGZpcnN0IGNvdW50ZXIgdG8gdGhlIHZhcmlhYmxlICdjaGlsZCcgdGhlbiB0YWtlIGEgbG9vayBpbnNpZGUuDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRX0NCmNoaWxkID0gcm9vdFswXQ0KY2hpbGQuaXRlbXMoKQ0KYGBgDQoNCldlIGNhbiBzZWUgdGhhdCAnY2hpbGQnIGNvbnRhaW5zIHRoZSAnY291bnQnLCAnZGF0ZScsICdkaXJlY3Rpb24nLCBhbmQgJ21vZGUnLg0KDQpUbyBpc29sYXRlIHRoZSBpbXBvcnRhbnQgaW5mb3JtYXRpb24gd2UgY2FuIHVzZSB0aGUgKipnZXQqKiBtZXRob2QgYW5kIHBhc3MgaW4gJ2NvdW50JywgJ2RhdGUnLCAnZGlyZWN0aW9uJywgb3IgJ21vZGUnIHRvIGdldCB0aGUgdmFsdWUuDQoNCmBgYHtweXRob24gY2FjaGU9VFJVRX0NCmNoaWxkLmdldCgnY291bnQnKQ0KY2hpbGQuZ2V0KCdkYXRlJykNCmNoaWxkLmdldCgnZGlyZWN0aW9uJykNCmNoaWxkLmdldCgnbW9kZScpDQpgYGANCk5vdyB0aGF0IHdlIGtub3cgaG93IHRvIHB1bGwgdGhlIGRhdGEgdGhhdCB3ZSB3YW50LCBsZXQncyBhdXRvbWF0ZSBpdC4NCg0KIyMgU3RlcCA1OiBBdXRvbWF0ZSBXaXRoIEEgRnVuY3Rpb24NCg0KSSdsbCBzaG93IHlvdSB0aGUgZnVuY3Rpb24gdGhhdCBJIGNyZWF0ZWQgdG8gaXRlcmF0ZSB0aHJvdWdoIHRoZSBYTUwgZGF0YS4gRXZlcnkgJ2NvdW50JyBhbmQgaXRzIGRldGFpbHMgd2lsbCBiZSBzYXZlZCBpbiBhIHR1cGxlIGFuZCB0aG9zZSB0dXBsZXMgd2lsbCBiZSBzYXZlZCBhbGwgdG9nZXRoZXIgaW4gYSBsaXN0Lg0KDQpGaXJzdCwgSSdsbCBjcmVhdGUgdGhlIGVtcHR5IGxpc3QgdGhhdCB3aWxsIGhvdXNlIHRoZSAnY291bnQnIHR1cGxlcy4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KY291bnRfaW5fZGF0ZV9yYW5nZV9saXN0ID0gW10NCmBgYA0KDQpOZXh0LCBJJ2xsIGNyZWF0ZSBhIGxpc3Qgb2YgdGhlIEJpa2VvbWV0ZXIgSUQncyB0aGF0IEknZCBsaWtlIHRvIHB1bGwgZGF0YSBmb3IuIE15IGZ1bmN0aW9uIHdpbGwgaXRlcmF0ZSBvdmVyIHRoaXMgbGlzdCB1c2luZyBhICoqZm9yIGxvb3AqKi4NCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KYmlrZW9tZXRlcl9pZF9saXN0ID0gWyczMycsJzMwJywnNDMnLCcyNCcsJzU5JywnNTYnLCc0NycsJzQ4JywnMTAnLCcyMCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAnMzUnLCc1NycsJzE4JywnMycsJzU4JywnNjEnLCc2MicsJzM4JywnNDQnLCcxNCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAnNjAnLCc1JywnNicsJzQyJywnMzcnLCcyNycsJzI2JywnOCcsJzcnLCc1MScsJzUyJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICc0NScsJzIyJywnMjEnLCczNicsJzM0JywnNDEnLCc5JywnMzknLCcxNicsJzE1JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICc1NCcsJzU1JywnMzEnLCcyOCcsJzExJywnMicsJzI1JywnMTknXQ0KYGBgDQoNCg0KTmV4dCwgSSdsbCBjcmVhdGUgYSBSdXNzaWFuIG5lc3RpbmcgZG9sbCBvZiBhICoqZm9yIGxvb3AqKiB0byBkaXZlIGludG8gdGhlIGFwcHJvcHJpYXRlIHNlY3Rpb25zIHRvIHB1bGwgdGhlIGluZm9ybWF0aW9uIEkgd2FudC4gSSdsbCB1c2UgdGhlICoqZGF0ZXRpbWUqKiBtb2R1bGUgdG8gc2VwYXJhdGUgb3V0IHRoZSANCg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KZnJvbSBkYXRldGltZSBpbXBvcnQgZGF0ZSwgZGF0ZXRpbWUsIHRpbWVkZWx0YQ0KDQpkZWYgYXBpX2NvdW50c190b19saXN0KCk6IA0KICBmb3IgYmlrZW9tZXRlcl9pZCBpbiBiaWtlb21ldGVyX2lkX2xpc3Q6DQogICAgcmVxdWVzdF9wYXJhbWV0ZXJzID0geydtZXRob2QnOiAnR2V0Q291bnRJbkRhdGVSYW5nZScsDQogICAgICAgICAgICAgICAgICAgICAgJ2NvdW50ZXJJRCc6IGJpa2VvbWV0ZXJfaWQsDQogICAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0RGF0ZSc6ICcwNy8yMi8yMDE1JyAsDQogICAgICAgICAgICAgICAgICAgICAgJ2VuZERhdGUnOiAnMDcvMjIvMjAxNScsDQogICAgICAgICAgICAgICAgICAgICAgJ21vZGUnOiAnQicsDQogICAgICAgICAgICAgICAgICAgICAgJ2ludGVydmFsJzogJ0QnLA0KICAgICAgICAgICAgICAgICAgICAgICdkaXJlY3Rpb24nOiAnJ30NCiAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHBhcmFtcz1yZXF1ZXN0X3BhcmFtZXRlcnMpDQogICAgc3RyaW5nX2RhdGEgPSByZXNwb25zZS50ZXh0DQogICAgY2xlYW5fc3RyaW5nX2RhdGEgPSByZS5zdWIocidbXG58XHRdJywgJycsIHN0cmluZ19kYXRhKQ0KICAgIHJvb3QgPSBFVC5mcm9tc3RyaW5nKGNsZWFuX3N0cmluZ19kYXRhKQ0KICAgIGZvciB0eXBlX3RhZyBpbiByb290LmZpbmRhbGwoJ2NvdW50Jyk6DQogICAgICAgIGNvdW50ID0gdHlwZV90YWcuZ2V0KCdjb3VudCcpDQogICAgICAgIGRhdGUgPSB0eXBlX3RhZy5nZXQoJ2RhdGUnKQ0KICAgICAgICAjIENvbnZlcnRzIGNvdW50ZXIgZGF0ZSB0byBhIGRhdGUgb2JqZWN0DQogICAgICAgIGRhdGUgPSBkYXRldGltZS5zdHJwdGltZShkYXRlLCAnJW0vJWQvJVknKS5kYXRlKCkNCiAgICAgICAgeWVhciA9IGRhdGUueWVhcg0KICAgICAgICBtb250aCA9IGRhdGUubW9udGgNCiAgICAgICAgZGF5ID0gZGF0ZS5kYXkNCiAgICAgICAgbW9udGhfZGF5ID0gZid7bW9udGh9X3tkYXl9Jw0KICAgICAgICBkaXJlY3Rpb24gPSB0eXBlX3RhZy5nZXQoJ2RpcmVjdGlvbicpDQogICAgICAgIGlmIGRhdGUud2Vla2RheSgpIDw9IDQ6DQogICAgICAgICAgICBpc193ZWVrZW5kID0gMA0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgaXNfd2Vla2VuZCA9IDENCiAgICAgICAgc2luZ2xlX3R1cGxlID0gKGJpa2VvbWV0ZXJfaWQsIGRhdGUsIGRpcmVjdGlvbiwgY291bnQsIGlzX3dlZWtlbmQsIHllYXIsIG1vbnRoLCBkYXksIG1vbnRoX2RheSkNCiAgICAgICAgY291bnRfaW5fZGF0ZV9yYW5nZV9saXN0LmFwcGVuZChzaW5nbGVfdHVwbGUpDQogIHJldHVybiBjb3VudF9pbl9kYXRlX3JhbmdlX2xpc3QNCmFsbF9pZF9saXN0ID0gYXBpX2NvdW50c190b19saXN0KCkNCmFsbF9pZF9saXN0DQpgYGANCkVhY2ggdHVwbGUgY29udGFpbnM6IChiaWtlb21ldGVyX2lkLCBkYXRlLCBkaXJlY3Rpb24sIGNvdW50LCBpc193ZWVrZW5kLCB5ZWFyLCBtb250aCwgZGF5LCBtb250aF9kYXkpLg0KDQpJIGFkZGVkIGEgZmV3IG1vcmUgdmFyaWFibGVzIGJ5IG1hbmlwdWxhdGluZyB0aGUgZGF0ZSBhIGJpdCBpbiBvcmRlciB0byBtYWtlIHRoZSBhbmFseXNpcyBsYXRlciBlYXNpZXIuDQoNCiMjIFN0ZXAgNjogRGF0YSBpbnRvIGEgZGF0YSBmcmFtZQ0KDQpGaXJzdCwgd2Ugd2lsbCBsb2FkIHRoYXQgKipQYW5kYXMqKiBtb2R1bGUgc28gd2UgY2FuIHR1cm4gb3VyIGxpc3Qgb2YgdHVwbGVzIGludG8gYSBkYXRhIGZyYW1lLg0KDQpgYGB7cHl0aG9uIGNhY2hlPVRSVUV9DQppbXBvcnQgcGFuZGFzIGFzIHBkDQpgYGANCg0KTmV4dCwgd2Ugd2lsbCBkZWZpbmUgdGhlIGNvbHVtbnMgb2YgdGhlIGRhdGEgZnJhbWUgYWNjb3JkaW5nIHRvIHRoZSBkYXRhIGluIG91ciB0dXBsZXMuIA0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KY29sdW1ucyA9ICgnYmlrZW9tZXRlcl9pZCcsICdkYXRlJywgJ2RpcmVjdGlvbicsICdjb3VudCcsICdpc193ZWVrZW5kJywgJ3llYXInLCAnbW9udGgnLCAnZGF5JywgJ21vbnRoX2RheScpDQpgYGANCg0KV2l0aCBvdXIgY29sdW1ucyBkZWZpbmVkLCB3ZSB3aWxsIGNyZWF0ZSBhIGRhdGFmcmFtZSB1c2luZyB0aGUgcGFuZGFzICoqRGF0YUZyYW1lKiogbWV0aG9kLCBwYXNzIGluIG91ciAqKmJpa2VvbWV0ZXJfZGV0YWlscyoqIGxpc3QgaW50byB0aGUgKipkYXRhKiogcGFyYW1ldGVyIGFuZCBwYXNzIGluIG91ciAqKmNvbHVtbnMqKiB2YXJpYWJsZSB0byB0aGUgKipjb2x1bW5zKiogcGFyYW1ldGVyLg0KYGBge3B5dGhvbiBjYWNoZT1UUlVFfQ0KZGYgPSBwZC5EYXRhRnJhbWUoYWxsX2lkX2xpc3QsIGNvbHVtbnM9Y29sdW1ucykNCmRmDQpgYGANCg0KTm93IHRoYXQgd2UgYXJlIGFibGUgdG8gYXV0b21hdGUgcHVsbGluZyB0aGUgZGF0YSBpbnRvIGEgZGF0YSBmcmFtZSwgaW4gdGhlIFtuZXh0IHBvc3RdKGh0dHBzOi8vbmF0aGFuc3Byb2plY3RzLmNvbS9wYXJ0XzNfc2V0dXBfeW91cl9kYXRhYmFzZS5odG1sKSwgd2UgY2FuIHNldCB1cCBvdXIgZGF0YWJhc2Ugd2hpY2ggd2Ugd2lsbCB1c2UgdG8gc3RvcmUgdGhlIGRhdGEgZm9yIGFuYWx5c2lzLiA=</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("part_2_query_the_api.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
